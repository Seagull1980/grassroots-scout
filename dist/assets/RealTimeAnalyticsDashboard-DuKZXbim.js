import{av as te,cd as m,j as e,B as s,T as n,ak as D,a1 as se,a2 as re,a3 as ne,i as u,X as ie,Y as oe,aj as le,I as R,au as ce,ce as de,cf as he,r as me,L as ue,G as h,C as pe,a as xe,z as k,d as L,a6 as ge,a7 as fe,a8 as je,n as E,s as _,a9 as ye,cg as z,ch as be,bh as F,ci as ve,f as we,e as Re,V as B,aQ as Se,ag as Ce,cj as Me}from"./mui-vendor-C1HUv1lu.js";import{r}from"./react-vendor-BW_9WhSV.js";import{L as Ae,C as Ie,a as Te,b as De,P as ke,c as Le,d as Ee,A as _e,R as ze,p as Fe,e as Be,f as Pe,i as $e}from"./charts-vendor-DPNYAcQ3.js";import{u as Ue}from"./admin-features-DSNbd77k.js";Ie.register(Te,De,ke,Le,Ee,_e,ze,Fe,Be,Pe,$e);const Ge=()=>{const o=te();Ue();const[P,p]=r.useState({activeUsers:0,pageViews:0,conversionRate:0,avgSessionDuration:0,bounceRate:0,errorRate:0,apiResponseTime:0,newSignups:0}),[$,x]=r.useState([]),[g,f]=r.useState([]),[l,U]=r.useState(!0),[j,V]=r.useState("1h"),[S,W]=r.useState(!1),[H,y]=r.useState(!1),[C,Y]=r.useState({}),[M,A]=r.useState(!1),c=r.useRef(null),d=r.useRef(null);r.useEffect(()=>(I(),l&&G(),()=>{N()}),[l,j]);const I=async()=>{A(!0);try{await b(),await v(),await q(),J()}catch(a){console.error("Failed to initialize real-time data:",a)}finally{A(!1)}},b=async()=>{try{const a=await fetch(`/api/analytics/real-time/metrics?range=${j}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(a.ok){const t=await a.json();p(t)}else p({activeUsers:Math.floor(Math.random()*50)+10,pageViews:Math.floor(Math.random()*500)+100,conversionRate:Math.random()*5+2,avgSessionDuration:Math.floor(Math.random()*300)+120,bounceRate:Math.random()*30+20,errorRate:Math.random()*2,apiResponseTime:Math.floor(Math.random()*200)+50,newSignups:Math.floor(Math.random()*10)+1})}catch(a){console.error("Failed to load metrics:",a)}},v=async()=>{try{const a=await fetch("/api/analytics/real-time/events?limit=50",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(a.ok){const t=await a.json();x(t)}else{const t=[];for(let i=0;i<20;i++)t.push({id:`event_${i}`,timestamp:Date.now()-i*3e4,event:["page_view","user_action","conversion"][Math.floor(Math.random()*3)],page:["/dashboard","/search","/profile","/analytics"][Math.floor(Math.random()*4)],type:["page_view","user_action","conversion","error"][Math.floor(Math.random()*4)],userId:Math.random()>.3?`user_${Math.floor(Math.random()*100)}`:void 0});x(t)}}catch(a){console.error("Failed to load events:",a)}},q=async()=>{try{const a=await fetch("/api/analytics/alerts",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(a.ok){const t=await a.json();f(t)}else{const t=[{id:"alert_1",type:"warning",title:"High Error Rate",message:"Error rate has increased by 15% in the last hour",timestamp:Date.now()-6e5,isRead:!1,actionRequired:!0},{id:"alert_2",type:"info",title:"Traffic Spike",message:"Page views increased by 40% compared to yesterday",timestamp:Date.now()-12e5,isRead:!1,actionRequired:!1}];f(t)}}catch(a){console.error("Failed to load alerts:",a)}},G=()=>{c.current=new EventSource("/api/analytics/real-time/stream"),c.current.onmessage=a=>{try{const t=JSON.parse(a.data);Z(t)}catch(t){console.error("Failed to parse real-time data:",t)}},c.current.onerror=a=>{console.error("Real-time connection error:",a),O()},d.current=setInterval(()=>{b(),v()},3e4)},N=()=>{c.current&&(c.current.close(),c.current=null),d.current&&(clearInterval(d.current),d.current=null)},O=()=>{d.current||(d.current=setInterval(()=>{b(),v()},5e3))},Z=a=>{switch(a.type){case"metrics_update":p(t=>({...t,...a.metrics}));break;case"new_event":x(t=>[a.event,...t.slice(0,49)]);break;case"alert":f(t=>[a.alert,...t]);break;default:console.log("Unknown real-time update type:",a.type)}},J=()=>{const a=Array.from({length:24},(Ve,ae)=>{const w=new Date;return w.setHours(w.getHours()-ae),w.getHours()+":00"}).reverse(),t=a.map(()=>Math.floor(Math.random()*100)+20),i=a.map(()=>Math.floor(Math.random()*50)+10),ee=a.map(()=>Math.floor(Math.random()*10)+2);Y({labels:a,datasets:[{label:"Page Views",data:t,borderColor:o.palette.primary.main,backgroundColor:m(o.palette.primary.main,.1),fill:!0,tension:.4},{label:"User Actions",data:i,borderColor:o.palette.secondary.main,backgroundColor:m(o.palette.secondary.main,.1),fill:!0,tension:.4},{label:"Conversions",data:ee,borderColor:o.palette.success.main,backgroundColor:m(o.palette.success.main,.1),fill:!0,tension:.4}]})},Q=a=>{switch(a){case"activeUsers":return e.jsx(z,{});case"pageViews":return e.jsx(B,{});case"conversionRate":return e.jsx(Re,{});case"avgSessionDuration":return e.jsx(we,{});case"bounceRate":return e.jsx(ve,{});case"errorRate":return e.jsx(F,{});case"apiResponseTime":return e.jsx(be,{});case"newSignups":return e.jsx(z,{});default:return e.jsx(D,{})}},T=(a,t)=>{switch(a){case"conversionRate":return t>3?"success":t>1.5?"warning":"error";case"bounceRate":return t<30?"success":t<50?"warning":"error";case"errorRate":return t<1?"success":t<3?"warning":"error";case"apiResponseTime":return t<100?"success":t<300?"warning":"error";default:return"primary"}},X=(a,t)=>{switch(a){case"conversionRate":case"bounceRate":return`${t.toFixed(1)}%`;case"avgSessionDuration":return`${Math.floor(t/60)}m ${Math.floor(t%60)}s`;case"apiResponseTime":return`${t}ms`;default:return t.toLocaleString()}},K=a=>{switch(a){case"page_view":return e.jsx(B,{fontSize:"small"});case"user_action":return e.jsx(Me,{fontSize:"small"});case"conversion":return e.jsx(Ce,{fontSize:"small"});case"error":return e.jsx(F,{fontSize:"small"});default:return e.jsx(Se,{fontSize:"small"})}};return e.jsxs(s,{sx:{p:3,minHeight:"100vh",bgcolor:"background.default"},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(n,{variant:"h4",fontWeight:"bold",children:[e.jsx(D,{sx:{mr:1,verticalAlign:"middle"}}),"Real-Time Analytics"]}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(se,{size:"small",sx:{minWidth:120},children:[e.jsx(re,{children:"Time Range"}),e.jsxs(ne,{value:j,onChange:a=>V(a.target.value),label:"Time Range",children:[e.jsx(u,{value:"15m",children:"Last 15min"}),e.jsx(u,{value:"1h",children:"Last Hour"}),e.jsx(u,{value:"24h",children:"Last 24h"}),e.jsx(u,{value:"7d",children:"Last 7 days"})]})]}),e.jsx(ie,{control:e.jsx(oe,{checked:l,onChange:a=>U(a.target.checked),color:"primary"}),label:"Real-time"}),e.jsx(le,{badgeContent:g.filter(a=>!a.isRead).length,color:"error",children:e.jsx(R,{onClick:()=>y(!0),children:e.jsx(ce,{})})}),e.jsx(R,{onClick:()=>W(!S),children:S?e.jsx(de,{}):e.jsx(he,{})}),e.jsx(R,{onClick:I,disabled:M,children:e.jsx(me,{})})]})]}),M&&e.jsx(ue,{sx:{mb:2}}),e.jsx(h,{container:!0,spacing:3,sx:{mb:3},children:Object.entries(P).map(([a,t])=>e.jsx(h,{item:!0,xs:12,sm:6,md:3,children:e.jsx(pe,{sx:{cursor:"pointer",transition:"transform 0.2s","&:hover":{transform:"translateY(-2px)"}},children:e.jsxs(xe,{children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(s,{children:[e.jsx(n,{color:"text.secondary",gutterBottom:!0,children:a.replace(/([A-Z])/g," $1").replace(/^./,i=>i.toUpperCase())}),e.jsx(n,{variant:"h4",component:"div",color:T(a,t),children:X(a,t)})]}),e.jsx(s,{sx:{color:T(a,t)+".main"},children:Q(a)})]}),l&&e.jsxs(s,{sx:{display:"flex",alignItems:"center",mt:1},children:[e.jsx(s,{sx:{width:8,height:8,borderRadius:"50%",bgcolor:"success.main",animation:"pulse 2s infinite","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.5},"100%":{opacity:1}}}}),e.jsx(n,{variant:"caption",sx:{ml:1,color:"success.main"},children:"Live"})]})]})})},a))}),e.jsxs(h,{container:!0,spacing:3,children:[e.jsx(h,{item:!0,xs:12,lg:8,children:e.jsxs(k,{sx:{p:3,height:400},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(n,{variant:"h6",children:"Activity Timeline"}),e.jsx(L,{label:l?"Live":"Paused",color:l?"success":"warning",size:"small"})]}),C.labels&&e.jsx(s,{sx:{height:320},children:e.jsx(Ae,{data:C,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!1}},scales:{y:{beginAtZero:!0},x:{display:!0}},animation:{duration:l?750:0}}})})]})}),e.jsx(h,{item:!0,xs:12,lg:4,children:e.jsxs(k,{sx:{p:3,height:400,overflow:"hidden"},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Live Events"}),e.jsx(s,{sx:{height:320,overflow:"auto"},children:$.map(a=>e.jsxs(s,{sx:{display:"flex",alignItems:"center",p:1,mb:1,bgcolor:m(o.palette.primary.main,.05),borderRadius:1,animation:"fadeIn 0.5s ease-in","@keyframes fadeIn":{from:{opacity:0,transform:"translateY(-10px)"},to:{opacity:1,transform:"translateY(0)"}}},children:[e.jsx(s,{sx:{mr:2},children:K(a.type)}),e.jsxs(s,{sx:{flexGrow:1},children:[e.jsx(n,{variant:"body2",fontWeight:"medium",children:a.event}),e.jsxs(n,{variant:"caption",color:"text.secondary",children:[a.page," â€¢ ",new Date(a.timestamp).toLocaleTimeString()]})]}),a.userId&&e.jsx(L,{label:a.userId,size:"small",variant:"outlined"})]},a.id))})]})})]}),e.jsxs(ge,{open:H,onClose:()=>y(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(fe,{children:"Performance Alerts"}),e.jsx(je,{children:g.length===0?e.jsx(E,{severity:"success",children:"No alerts at this time"}):e.jsx(s,{children:g.map(a=>e.jsxs(E,{severity:a.type,sx:{mb:2},action:a.actionRequired&&e.jsx(_,{size:"small",variant:"outlined",children:"Take Action"}),children:[e.jsx(n,{variant:"subtitle2",fontWeight:"bold",children:a.title}),e.jsx(n,{variant:"body2",children:a.message}),e.jsx(n,{variant:"caption",color:"text.secondary",children:new Date(a.timestamp).toLocaleString()})]},a.id))})}),e.jsx(ye,{children:e.jsx(_,{onClick:()=>y(!1),children:"Close"})})]})]})};export{Ge as default};
