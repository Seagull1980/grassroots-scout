import{j as e,b8 as G,n as H,B as n,T as r,s as u,D as le,r as ne,G as i,C as j,a as g,b3 as B,b4 as D,e as oe,z as L,a1 as p,a2 as b,a3 as v,i as t,ah as ce,ai as P,d as h,c1 as de,a6 as xe,a7 as ue,I as he,ac as me,a8 as je,a0 as _,H as ge,as as pe,at as be,l as ve,a9 as fe,ab as ye}from"./mui-vendor-JAsu9f5S.js";import{r as o}from"./react-vendor-BTglNIF_.js";import{u as we,c as f,R as y}from"./admin-features-R-myf6Sn.js";const Ie=()=>{const{user:z}=we(),[w,J]=o.useState("all"),[$,q]=o.useState([]),[c,V]=o.useState(null),[K,W]=o.useState(!0),[a,C]=o.useState(null),[N,E]=o.useState([]),[k,R]=o.useState(""),[S,Q]=o.useState(""),[I,X]=o.useState(""),[F,Y]=o.useState(""),[M,Z]=o.useState(!1),[U,d]=o.useState("");o.useEffect(()=>{z?.role==="Admin"&&m()},[z,w,S,I,F]);const m=async()=>{W(!0),d("");try{const s=localStorage.getItem("token"),l={};w!=="all"&&(l.feedbackType=w==="bugs"?"bug":"improvement"),S&&(l.status=S),I&&(l.priority=I),F&&(l.category=F);const x=await f.get(`${y}/admin/feedback`,{headers:{Authorization:`Bearer ${s}`},params:l});q(x.data.feedback),V(x.data.stats)}catch(s){d(s.response?.data?.error||"Failed to fetch feedback")}finally{W(!1)}},O=async s=>{try{const l=localStorage.getItem("token"),x=await f.get(`${y}/feedback/${s}`,{headers:{Authorization:`Bearer ${l}`}});E(x.data.comments)}catch(l){d(l.response?.data?.error||"Failed to fetch feedback details")}},ee=s=>{C(s),R(""),O(s.id)},A=()=>{C(null),E([])},T=async s=>{if(a)try{const l=localStorage.getItem("token");if(await f.put(`${y}/admin/feedback/${a.id}`,s,{headers:{Authorization:`Bearer ${l}`}}),await m(),a){const x=$.find(ie=>ie.id===a.id);x&&C({...x,...s})}}catch(l){d(l.response?.data?.error||"Failed to update feedback")}},se=async()=>{if(!(!a||!k.trim()))try{const s=localStorage.getItem("token");await f.post(`${y}/feedback/${a.id}/comments`,{comment:k.trim()},{headers:{Authorization:`Bearer ${s}`}}),R(""),await O(a.id),await m()}catch(s){d(s.response?.data?.error||"Failed to add comment")}},te=async s=>{if(confirm("Are you sure you want to delete this feedback?"))try{const l=localStorage.getItem("token");await f.delete(`${y}/admin/feedback/${s}`,{headers:{Authorization:`Bearer ${l}`}}),await m(),A()}catch(l){d(l.response?.data?.error||"Failed to delete feedback")}},re=s=>{switch(s){case"critical":return"error";case"high":return"warning";case"medium":return"info";case"low":return"default";default:return"default"}},ae=s=>{switch(s){case"new":return"primary";case"reviewing":return"info";case"in-progress":return"warning";case"completed":return"success";case"wont-fix":return"default";case"duplicate":return"default";default:return"default"}};return z?.role!=="Admin"?e.jsx(G,{maxWidth:"lg",sx:{mt:4},children:e.jsx(H,{severity:"error",children:"Admin access required"})}):e.jsxs(G,{maxWidth:"xl",sx:{mt:4,mb:4},children:[e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(r,{variant:"h4",gutterBottom:!0,children:"Feedback Dashboard"}),e.jsxs(n,{display:"flex",gap:1,children:[e.jsx(u,{variant:"outlined",startIcon:e.jsx(le,{}),onClick:()=>Z(!M),children:"Filters"}),e.jsx(u,{variant:"outlined",startIcon:e.jsx(ne,{}),onClick:m,children:"Refresh"})]})]}),U&&e.jsx(H,{severity:"error",sx:{mb:2},onClose:()=>d(""),children:U}),c&&e.jsxs(i,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(r,{variant:"h4",children:c.total}),e.jsx(r,{color:"text.secondary",children:"Total Submissions"})]})})}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsx(j,{children:e.jsxs(g,{children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(B,{color:"error"}),e.jsx(r,{variant:"h4",children:c.bugs})]}),e.jsx(r,{color:"text.secondary",children:"Bug Reports"})]})})}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsx(j,{children:e.jsxs(g,{children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(D,{color:"primary"}),e.jsx(r,{variant:"h4",children:c.improvements})]}),e.jsx(r,{color:"text.secondary",children:"Improvements"})]})})}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsx(j,{children:e.jsxs(g,{children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(oe,{color:"warning"}),e.jsx(r,{variant:"h4",children:c.newItems})]}),e.jsx(r,{color:"text.secondary",children:"New Items"})]})})})]}),M&&e.jsx(L,{sx:{p:2,mb:2},children:e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,sm:4,children:e.jsxs(p,{fullWidth:!0,size:"small",children:[e.jsx(b,{children:"Status"}),e.jsxs(v,{value:S,onChange:s=>Q(s.target.value),label:"Status",children:[e.jsx(t,{value:"",children:"All"}),e.jsx(t,{value:"new",children:"New"}),e.jsx(t,{value:"reviewing",children:"Reviewing"}),e.jsx(t,{value:"in-progress",children:"In Progress"}),e.jsx(t,{value:"completed",children:"Completed"}),e.jsx(t,{value:"wont-fix",children:"Won't Fix"}),e.jsx(t,{value:"duplicate",children:"Duplicate"})]})]})}),e.jsx(i,{item:!0,xs:12,sm:4,children:e.jsxs(p,{fullWidth:!0,size:"small",children:[e.jsx(b,{children:"Priority"}),e.jsxs(v,{value:I,onChange:s=>X(s.target.value),label:"Priority",children:[e.jsx(t,{value:"",children:"All"}),e.jsx(t,{value:"low",children:"Low"}),e.jsx(t,{value:"medium",children:"Medium"}),e.jsx(t,{value:"high",children:"High"}),e.jsx(t,{value:"critical",children:"Critical"})]})]})}),e.jsx(i,{item:!0,xs:12,sm:4,children:e.jsxs(p,{fullWidth:!0,size:"small",children:[e.jsx(b,{children:"Category"}),e.jsxs(v,{value:F,onChange:s=>Y(s.target.value),label:"Category",children:[e.jsx(t,{value:"",children:"All"}),e.jsx(t,{value:"general",children:"General"}),e.jsx(t,{value:"search",children:"Search & Filtering"}),e.jsx(t,{value:"messaging",children:"Messaging"}),e.jsx(t,{value:"team-roster",children:"Team Roster"}),e.jsx(t,{value:"maps",children:"Maps & Location"}),e.jsx(t,{value:"dashboard",children:"Dashboard"}),e.jsx(t,{value:"performance",children:"Performance"}),e.jsx(t,{value:"mobile",children:"Mobile Experience"}),e.jsx(t,{value:"other",children:"Other"})]})]})})]})}),e.jsxs(ce,{value:w,onChange:(s,l)=>J(l),sx:{mb:2},children:[e.jsx(P,{label:"All Feedback",value:"all"}),e.jsx(P,{icon:e.jsx(B,{}),iconPosition:"start",label:`Bugs (${c?.bugs||0})`,value:"bugs"}),e.jsx(P,{icon:e.jsx(D,{}),iconPosition:"start",label:`Improvements (${c?.improvements||0})`,value:"improvements"})]}),K?e.jsx(r,{children:"Loading..."}):$.length===0?e.jsx(L,{sx:{p:3,textAlign:"center"},children:e.jsx(r,{color:"text.secondary",children:"No feedback found"})}):e.jsx(i,{container:!0,spacing:2,children:$.map(s=>e.jsx(i,{item:!0,xs:12,children:e.jsx(j,{children:e.jsx(g,{children:e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",children:[e.jsxs(n,{flex:1,children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:1,mb:1,children:[s.feedbackType==="bug"?e.jsx(B,{color:"error"}):e.jsx(D,{color:"primary"}),e.jsx(r,{variant:"h6",children:s.title})]}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:1},children:s.description.length>150?`${s.description.substring(0,150)}...`:s.description}),e.jsxs(n,{display:"flex",gap:1,flexWrap:"wrap",mb:1,children:[e.jsx(h,{label:s.status.replace("-"," "),color:ae(s.status),size:"small"}),e.jsx(h,{label:s.priority,color:re(s.priority),size:"small"}),e.jsx(h,{label:s.category,size:"small",variant:"outlined"}),e.jsx(h,{label:`${s.firstName} ${s.lastName} (${s.userRole})`,size:"small",variant:"outlined"}),s.commentCount>0&&e.jsx(h,{icon:e.jsx(de,{}),label:s.commentCount,size:"small",variant:"outlined"})]}),e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Submitted: ",new Date(s.createdAt).toLocaleString()]})]}),e.jsx(u,{variant:"outlined",size:"small",onClick:()=>ee(s),children:"View Details"})]})})})},s.id))}),e.jsx(xe,{open:!!a,onClose:A,maxWidth:"md",fullWidth:!0,children:a&&e.jsxs(e.Fragment,{children:[e.jsx(ue,{children:e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:1,children:[a.feedbackType==="bug"?e.jsx(B,{color:"error"}):e.jsx(D,{color:"primary"}),a.title]}),e.jsx(he,{onClick:A,children:e.jsx(me,{})})]})}),e.jsx(je,{dividers:!0,children:e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:12,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Description"}),e.jsx(r,{variant:"body1",sx:{mb:2,whiteSpace:"pre-wrap"},children:a.description})]}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(p,{fullWidth:!0,size:"small",children:[e.jsx(b,{children:"Status"}),e.jsxs(v,{value:a.status,onChange:s=>T({status:s.target.value}),label:"Status",children:[e.jsx(t,{value:"new",children:"New"}),e.jsx(t,{value:"reviewing",children:"Reviewing"}),e.jsx(t,{value:"in-progress",children:"In Progress"}),e.jsx(t,{value:"completed",children:"Completed"}),e.jsx(t,{value:"wont-fix",children:"Won't Fix"}),e.jsx(t,{value:"duplicate",children:"Duplicate"})]})]})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(p,{fullWidth:!0,size:"small",children:[e.jsx(b,{children:"Priority"}),e.jsxs(v,{value:a.priority,onChange:s=>T({priority:s.target.value}),label:"Priority",children:[e.jsx(t,{value:"low",children:"Low"}),e.jsx(t,{value:"medium",children:"Medium"}),e.jsx(t,{value:"high",children:"High"}),e.jsx(t,{value:"critical",children:"Critical"})]})]})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(_,{fullWidth:!0,label:"Admin Notes",value:a.adminNotes||"",onChange:s=>C({...a,adminNotes:s.target.value}),onBlur:s=>T({adminNotes:s.target.value}),multiline:!0,rows:2,size:"small"})}),e.jsxs(i,{item:!0,xs:12,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Submitted By"}),e.jsxs(r,{variant:"body2",children:[a.firstName," ",a.lastName," (",a.userRole,")"]}),e.jsx(r,{variant:"body2",children:a.email})]}),a.pageUrl&&e.jsxs(i,{item:!0,xs:12,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Page URL"}),e.jsx(r,{variant:"body2",sx:{wordBreak:"break-all"},children:a.pageUrl})]}),a.browserInfo&&e.jsxs(i,{item:!0,xs:12,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Browser Info"}),e.jsx(L,{variant:"outlined",sx:{p:1,bgcolor:"grey.50"},children:e.jsx(r,{variant:"caption",component:"pre",sx:{whiteSpace:"pre-wrap"},children:JSON.stringify(JSON.parse(a.browserInfo),null,2)})})]}),e.jsxs(i,{item:!0,xs:12,children:[e.jsx(ge,{sx:{my:2}}),e.jsxs(r,{variant:"h6",gutterBottom:!0,children:["Comments (",N.length,")"]}),N.length===0?e.jsx(r,{variant:"body2",color:"text.secondary",children:"No comments yet"}):e.jsx(pe,{children:N.map(s=>e.jsx(be,{sx:{bgcolor:s.isAdminComment?"primary.50":"grey.50",mb:1,borderRadius:1},children:e.jsx(ve,{primary:e.jsxs(n,{display:"flex",alignItems:"center",gap:1,children:[e.jsxs(r,{variant:"subtitle2",children:[s.firstName," ",s.lastName]}),s.isAdminComment&&e.jsx(h,{label:"Admin",size:"small",color:"primary"}),e.jsx(r,{variant:"caption",color:"text.secondary",children:new Date(s.createdAt).toLocaleString()})]}),secondary:s.comment})},s.id))}),e.jsxs(n,{display:"flex",gap:1,mt:2,children:[e.jsx(_,{fullWidth:!0,placeholder:"Add a comment...",value:k,onChange:s=>R(s.target.value),size:"small",multiline:!0,maxRows:3}),e.jsx(u,{variant:"contained",onClick:se,disabled:!k.trim(),children:"Send"})]})]})]})}),e.jsxs(fe,{children:[e.jsx(u,{color:"error",startIcon:e.jsx(ye,{}),onClick:()=>te(a.id),children:"Delete"}),e.jsx(u,{onClick:A,children:"Close"})]})]})})]})};export{Ie as default};
