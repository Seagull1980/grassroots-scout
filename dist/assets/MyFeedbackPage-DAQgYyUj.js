import{j as e,b9 as H,B as a,T as s,s as d,r as M,n as b,z as O,af as L,G as n,C as G,a as U,b4 as R,b5 as z,d as l,c2 as _,b3 as V,a6 as q,a7 as J,I as K,ac as Q,a8 as X,H as Y,as as Z,at as ee,l as te,a0 as se,a9 as re}from"./mui-vendor-C1HUv1lu.js";import{r as i}from"./react-vendor-BW_9WhSV.js";import{u as ae,c as g,R as y,n as f}from"./admin-features-DSNbd77k.js";import{F as ne}from"./index-Dby9pz-8.js";import"./analytics-features-ydPRNUK_.js";import"./maps-features-Cf5ETjC5.js";import"./maps-vendor-BfPVeWMj.js";const me=()=>{const{user:C}=ae(),[k,$]=i.useState([]),[N,v]=i.useState(!0),[r,w]=i.useState(null),[m,S]=i.useState([]),[x,h]=i.useState(""),[T,j]=i.useState(!1),[A,c]=i.useState("");i.useEffect(()=>{C&&u()},[C]);const u=async()=>{v(!0),c("");try{const t=localStorage.getItem("token"),o=await g.get(`${y}/feedback/my-submissions`,{headers:{Authorization:`Bearer ${t}`,...f}});$(o.data.feedback)}catch(t){c(t.response?.data?.error||"Failed to fetch feedback")}finally{v(!1)}},F=async t=>{try{const o=localStorage.getItem("token"),W=await g.get(`${y}/feedback/${t}`,{headers:{Authorization:`Bearer ${o}`,...f}});S(W.data.comments)}catch(o){c(o.response?.data?.error||"Failed to fetch feedback details")}},E=t=>{w(t),h(""),F(t.id)},p=()=>{w(null),S([])},P=async()=>{if(!(!r||!x.trim()))try{const t=localStorage.getItem("token");await g.post(`${y}/feedback/${r.id}/comments`,{comment:x.trim()},{headers:{Authorization:`Bearer ${t}`,...f}}),h(""),await F(r.id),await u()}catch(t){c(t.response?.data?.error||"Failed to add comment")}},I=t=>{switch(t){case"critical":return"error";case"high":return"warning";case"medium":return"info";case"low":return"default";default:return"default"}},D=t=>{switch(t){case"new":return"primary";case"reviewing":return"info";case"in-progress":return"warning";case"completed":return"success";case"wont-fix":return"default";case"duplicate":return"default";default:return"default"}},B=t=>t.split("-").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ");return e.jsxs(H,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsxs(a,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(s,{variant:"h4",gutterBottom:!0,children:"My Feedback"}),e.jsx(d,{variant:"outlined",startIcon:e.jsx(M,{}),onClick:u,children:"Refresh"})]}),A&&e.jsx(b,{severity:"error",sx:{mb:2},onClose:()=>c(""),children:A}),e.jsx(b,{severity:"info",sx:{mb:3},children:"Help us improve! Report bugs or suggest new features. Our team reviews all feedback."}),N?e.jsx(s,{children:"Loading..."}):k.length===0?e.jsxs(O,{sx:{p:4,textAlign:"center"},children:[e.jsx(s,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No feedback submissions yet"}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Have a bug to report or an idea to share? Let us know!"}),e.jsx(d,{variant:"contained",startIcon:e.jsx(L,{}),onClick:()=>j(!0),children:"Submit Feedback"})]}):e.jsx(n,{container:!0,spacing:2,children:k.map(t=>e.jsx(n,{item:!0,xs:12,children:e.jsx(G,{children:e.jsx(U,{children:e.jsxs(a,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",children:[e.jsxs(a,{flex:1,children:[e.jsxs(a,{display:"flex",alignItems:"center",gap:1,mb:1,children:[t.feedbackType==="bug"?e.jsx(R,{color:"error"}):e.jsx(z,{color:"primary"}),e.jsx(s,{variant:"h6",children:t.title})]}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:1},children:t.description.length>150?`${t.description.substring(0,150)}...`:t.description}),e.jsxs(a,{display:"flex",gap:1,flexWrap:"wrap",mb:1,children:[e.jsx(l,{label:B(t.status),color:D(t.status),size:"small"}),e.jsx(l,{label:t.priority,color:I(t.priority),size:"small"}),e.jsx(l,{label:t.category,size:"small",variant:"outlined"}),t.commentCount>0&&e.jsx(l,{icon:e.jsx(_,{}),label:`${t.commentCount} comment${t.commentCount>1?"s":""}`,size:"small",variant:"outlined",color:t.commentCount>0?"primary":"default"})]}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:["Submitted: ",new Date(t.createdAt).toLocaleString(),t.status==="completed"&&t.resolvedAt&&e.jsxs(e.Fragment,{children:[" â€¢ Resolved: ",new Date(t.resolvedAt).toLocaleString()]})]})]}),e.jsx(d,{variant:"outlined",size:"small",onClick:()=>E(t),children:"View Details"})]})})})},t.id))}),e.jsx(V,{color:"primary","aria-label":"add feedback",sx:{position:"fixed",bottom:16,right:16},onClick:()=>j(!0),children:e.jsx(L,{})}),e.jsx(q,{open:!!r,onClose:p,maxWidth:"md",fullWidth:!0,children:r&&e.jsxs(e.Fragment,{children:[e.jsx(J,{children:e.jsxs(a,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(a,{display:"flex",alignItems:"center",gap:1,children:[r.feedbackType==="bug"?e.jsx(R,{color:"error"}):e.jsx(z,{color:"primary"}),r.title]}),e.jsx(K,{onClick:p,children:e.jsx(Q,{})})]})}),e.jsx(X,{dividers:!0,children:e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:12,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Description"}),e.jsx(s,{variant:"body1",sx:{mb:2,whiteSpace:"pre-wrap"},children:r.description})]}),e.jsxs(n,{item:!0,xs:12,sm:6,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Status"}),e.jsx(l,{label:B(r.status),color:D(r.status),sx:{mt:.5}})]}),e.jsxs(n,{item:!0,xs:12,sm:6,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Priority"}),e.jsx(l,{label:r.priority,color:I(r.priority),sx:{mt:.5}})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Category"}),e.jsx(s,{variant:"body2",children:r.category})]}),r.adminNotes&&e.jsx(n,{item:!0,xs:12,children:e.jsxs(b,{severity:"info",children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Admin Notes"}),e.jsx(s,{variant:"body2",children:r.adminNotes})]})}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx(Y,{sx:{my:2}}),e.jsxs(s,{variant:"h6",gutterBottom:!0,children:["Comments (",m.length,")"]}),m.length===0?e.jsx(s,{variant:"body2",color:"text.secondary",children:"No comments yet"}):e.jsx(Z,{children:m.map(t=>e.jsx(ee,{sx:{bgcolor:t.isAdminComment?"primary.50":"grey.50",mb:1,borderRadius:1},children:e.jsx(te,{primary:e.jsxs(a,{display:"flex",alignItems:"center",gap:1,children:[e.jsxs(s,{variant:"subtitle2",children:[t.firstName," ",t.lastName]}),t.isAdminComment&&e.jsx(l,{label:"Admin",size:"small",color:"primary"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:new Date(t.createdAt).toLocaleString()})]}),secondary:t.comment})},t.id))}),e.jsxs(a,{display:"flex",gap:1,mt:2,children:[e.jsx(se,{fullWidth:!0,placeholder:"Add a comment...",value:x,onChange:t=>h(t.target.value),size:"small",multiline:!0,maxRows:3}),e.jsx(d,{variant:"contained",onClick:P,disabled:!x.trim(),children:"Send"})]})]})]})}),e.jsx(re,{children:e.jsx(d,{onClick:p,children:"Close"})})]})}),e.jsx(ne,{open:T,onClose:()=>{j(!1),u()}})]})};export{me as default};
