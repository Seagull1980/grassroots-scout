import{a9 as ve,aa as Ce,j as e,ae as F,B as n,T as t,v as r,A as Ae,bj as we,cb as M,I as U,c9 as Ie,M as ke,q as L,b7 as z,am as Se,a6 as N,bx as H,bm as R,i as Y,G as c,C as p,a as b,ab as se,cc as Te,D as Le,k as We,l as Pe,m as O,h as De,w as te,ak as Fe,b8 as Ne,b9 as Ge,ba as Be,bb as q,bc as i,bd as Ee,ap as Me,ay as Ue,bB as Q,g as ze,bA as He,J as ne,K as re,N as ae,O as g,Q as ie}from"./mui-vendor-rZ0WLTig.js";import{u as Re,r as o}from"./react-vendor-CRXLTmIH.js";import{u as Ye,S as Oe,l as m,k as qe,m as Qe}from"./admin-features-d6LVy8Ft.js";const Je=()=>{console.log("ðŸ” AdminPage render start"),console.log("ðŸ”— Hook 1: useAuth");const{impersonateUser:oe,stopImpersonation:le,isImpersonating:j,user:d}=Ye();console.log("ðŸ”— Hook 2: useNavigate");const W=Re();console.log("ðŸ”— Hook 3: useTheme");const ce=ve();console.log("ðŸ”— Hook 4: useMediaQuery");const P=Ce(ce.breakpoints.down("md"));console.log("ðŸ”— Hook 5-19: useState hooks");const[G,k]=o.useState([]),[V,D]=o.useState(!1),[$,x]=o.useState(null),[_,y]=o.useState(null),[de,v]=o.useState(!1),[f,B]=o.useState(null),[S,xe]=o.useState(0),[J,K]=o.useState(null),[l,h]=o.useState({name:"",region:"",ageGroup:"",url:"",description:""}),[u,T]=o.useState({email:"",firstName:"",lastName:"",password:""}),[he,C]=o.useState(!1),[X,A]=o.useState(!1);if(console.log("ðŸ” All hooks declared, user check:",d?"exists":"null"),o.useEffect(()=>{(async()=>{if(!(!d||d.role!=="Admin"))try{D(!0);const a=await m.getAll();k(a.leagues||[])}catch(a){x(qe(a))}finally{D(!1)}})()},[d]),!d)return e.jsx(F,{maxWidth:"lg",children:e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsxs("div",{children:[e.jsx(t,{variant:"h4",color:"error",gutterBottom:!0,children:"Access Denied"}),e.jsx(t,{variant:"body1",children:"Please log in to access the admin panel."}),e.jsx(r,{variant:"contained",onClick:()=>W("/login"),sx:{mt:2},children:"Go to Login"})]})})});if(d.role!=="Admin")return e.jsx(F,{maxWidth:"lg",children:e.jsxs(n,{sx:{textAlign:"center",mt:4},children:[e.jsx(t,{variant:"h4",color:"error",gutterBottom:!0,children:"Access Denied"}),e.jsx(t,{variant:"body1",children:"You do not have permission to access this page."}),e.jsx(r,{variant:"contained",onClick:()=>W("/dashboard"),sx:{mt:2},children:"Go to Dashboard"})]})});const Z=()=>{x(null),y(null)},ue=(s,a)=>{xe(a)},ge=s=>{K(s.currentTarget)},w=()=>{K(null)},me=async()=>{try{await m.create(l),y("League created successfully"),v(!1),h({name:"",region:"",ageGroup:"",url:"",description:""});const s=await m.getAll();k(s.leagues||[])}catch(s){x(s.response?.data?.error||"Failed to create league")}},je=async()=>{if(f)try{await m.update(typeof f.id=="string"?parseInt(f.id):f.id,l),y("League updated successfully"),v(!1),B(null),h({name:"",region:"",ageGroup:"",url:"",description:""});const s=await m.getAll();k(s.leagues||[])}catch(s){x(s.response?.data?.error||"Failed to update league")}},pe=async s=>{if(window.confirm("Are you sure you want to delete this league?"))try{await m.delete(s),y("League deleted successfully");const a=await m.getAll();k(a.leagues||[])}catch(a){x(a.response?.data?.error||"Failed to delete league")}},be=async()=>{if(window.confirm("This will add all FA leagues to the database. Continue?"))try{D(!0);const s=await m.populateFALeagues();y(`FA leagues populated: ${s.inserted} inserted, ${s.skipped} skipped`);const a=await m.getAll();k(a.leagues||[])}catch(s){x(s.response?.data?.error||"Failed to populate FA leagues")}finally{D(!1)}},fe=s=>{B(s),h({name:s.name,region:s.region||"",ageGroup:s.ageGroup||"",url:s.url||"",description:s.description||""}),v(!0)},ee=()=>{B(null),h({name:"",region:"",ageGroup:"",url:"",description:""}),v(!0)},ye=async()=>{try{await Qe.createAdmin(u),y("Admin user created successfully"),C(!1),T({email:"",firstName:"",lastName:"",password:""})}catch(s){x(s.response?.data?.error||"Failed to create admin user")}},I=s=>{if(X){console.log("â³ Impersonation already in progress, ignoring request");return}try{A(!0),console.log("ðŸ”„ Attempting to impersonate user type:",s),console.log("ðŸ‘¤ Current user:",d),console.log("ðŸ” Is impersonating:",j),oe(s),console.log("âœ… Impersonation successful, navigating to dashboard..."),setTimeout(()=>{W("/dashboard"),A(!1)},100)}catch(a){console.error("âŒ Error during user impersonation:",a),x("Failed to switch user. Please try again."),A(!1)}},E=()=>{if(X){console.log("â³ Impersonation operation already in progress, ignoring request");return}try{A(!0),console.log("ðŸ”„ Stopping impersonation..."),le(),console.log("âœ… Impersonation stopped, navigating to admin..."),setTimeout(()=>{W("/admin"),A(!1)},100)}catch(s){console.error("âŒ Error stopping impersonation:",s),x("Failed to stop impersonation. Please try again."),A(!1)}};return e.jsxs(n,{sx:{flexGrow:1,minHeight:"100vh",backgroundColor:"background.default"},children:[e.jsx(n,{sx:{background:"linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%)",borderRadius:0,mb:3},children:e.jsx(F,{maxWidth:"lg",children:e.jsxs(n,{sx:{py:3,px:2},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",flexGrow:1},children:[e.jsx(Ae,{sx:{mr:2,bgcolor:"rgba(255,255,255,0.2)",width:56,height:56},children:e.jsx(we,{sx:{fontSize:32}})}),e.jsxs(n,{children:[e.jsx(t,{variant:P?"h5":"h4",component:"h1",sx:{fontWeight:700,color:"white",textShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:"Admin Dashboard"}),e.jsx(t,{variant:"body1",sx:{color:"rgba(255,255,255,0.9)",fontWeight:500},children:j?`Currently viewing as ${d.role}`:"System Management & Analytics"})]})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[!P&&e.jsx(e.Fragment,{children:j&&e.jsx(r,{startIcon:e.jsx(M,{}),variant:"outlined",sx:{borderColor:"rgba(255,255,255,0.5)",color:"white","&:hover":{borderColor:"white",bgcolor:"rgba(255,255,255,0.1)"}},onClick:E,children:"Stop Impersonation"})}),e.jsx(U,{color:"inherit",onClick:ge,sx:{bgcolor:"rgba(255,255,255,0.1)","&:hover":{bgcolor:"rgba(255,255,255,0.2)"}},children:e.jsx(Ie,{})})]})]})})}),e.jsxs(ke,{anchorEl:J,open:!!J,onClose:w,PaperProps:{sx:{minWidth:200}},children:[e.jsxs(L,{onClick:()=>{w(),C(!0)},children:[e.jsx(z,{sx:{mr:2}}),"Create Admin"]}),e.jsx(Se,{}),j?e.jsxs(L,{onClick:()=>{w(),E()},children:[e.jsx(M,{sx:{mr:2}}),"Stop Impersonation"]}):e.jsxs(e.Fragment,{children:[e.jsxs(L,{onClick:()=>{w(),I("Player")},children:[e.jsx(N,{sx:{mr:2}}),"Test as Player"]}),e.jsxs(L,{onClick:()=>{w(),I("Coach")},children:[e.jsx(H,{sx:{mr:2}}),"Test as Coach"]}),e.jsxs(L,{onClick:()=>{w(),I("Parent/Guardian")},children:[e.jsx(R,{sx:{mr:2}}),"Test as Parent"]})]})]}),e.jsxs(F,{maxWidth:"lg",sx:{py:4},children:[$&&e.jsx(Y,{severity:"error",sx:{mb:3},onClose:Z,children:$}),_&&e.jsx(Y,{severity:"success",sx:{mb:3},onClose:Z,children:_}),j&&e.jsxs(Y,{severity:"info",sx:{mb:3},action:e.jsx(r,{color:"inherit",size:"small",onClick:E,startIcon:e.jsx(M,{}),children:"Stop"}),children:[e.jsx(t,{variant:"body2",fontWeight:"bold",children:"Impersonation Mode Active"}),"You are currently viewing the platform as a ",e.jsx("strong",{children:d.role}),'. Click "Stop" to return to admin view.']}),e.jsxs(c,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(c,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(p,{sx:{background:"linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%)",color:"white"},children:e.jsx(b,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(n,{children:[e.jsx(t,{variant:"h4",fontWeight:"bold",children:G.length}),e.jsx(t,{variant:"body2",sx:{opacity:.9},children:"Active Leagues"})]}),e.jsx(se,{sx:{fontSize:40,opacity:.8}})]})})})}),e.jsx(c,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(p,{sx:{background:"linear-gradient(135deg, #64748B 0%, #475569 100%)",color:"white"},children:e.jsx(b,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(n,{children:[e.jsx(t,{variant:"h4",fontWeight:"bold",children:"1,247"}),e.jsx(t,{variant:"body2",sx:{opacity:.9},children:"Total Users"})]}),e.jsx(Te,{sx:{fontSize:40,opacity:.8}})]})})})}),e.jsx(c,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(p,{sx:{background:"linear-gradient(135deg, #94A3B8 0%, #64748B 100%)",color:"white"},children:e.jsx(b,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(n,{children:[e.jsx(t,{variant:"h4",fontWeight:"bold",children:"342"}),e.jsx(t,{variant:"body2",sx:{opacity:.9},children:"Active Matches"})]}),e.jsx(Le,{sx:{fontSize:40,opacity:.8}})]})})})})]}),e.jsxs(We,{elevation:2,sx:{mb:4},children:[e.jsxs(Pe,{value:S,onChange:ue,variant:P?"scrollable":"fullWidth",scrollButtons:"auto",sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(O,{label:"League Management",icon:e.jsx(se,{}),iconPosition:"start",sx:{minHeight:64}}),e.jsx(O,{label:"User Testing",icon:e.jsx(N,{}),iconPosition:"start",sx:{minHeight:64}}),e.jsx(O,{label:"System Settings",icon:e.jsx(De,{}),iconPosition:"start",sx:{minHeight:64}})]}),e.jsxs(n,{sx:{p:3},children:[S===0&&e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(t,{variant:"h5",component:"h2",children:"League Management"}),e.jsxs(n,{sx:{display:"flex",gap:2},children:[e.jsx(r,{variant:"outlined",onClick:be,disabled:V,children:"Populate FA Leagues"}),e.jsx(r,{variant:"contained",startIcon:e.jsx(te,{}),onClick:ee,children:"Add League"})]})]}),V?e.jsx(n,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(Fe,{})}):e.jsx(Ne,{children:e.jsxs(Ge,{children:[e.jsx(Be,{children:e.jsxs(q,{children:[e.jsx(i,{children:"Name"}),e.jsx(i,{children:"Region"}),e.jsx(i,{children:"Age Group"}),e.jsx(i,{children:"URL"}),e.jsx(i,{children:"Description"}),e.jsx(i,{align:"center",children:"Actions"})]})}),e.jsxs(Ee,{children:[G.map(s=>e.jsxs(q,{hover:!0,children:[e.jsx(i,{children:e.jsx(t,{variant:"subtitle2",fontWeight:"bold",children:s.name})}),e.jsx(i,{children:e.jsx(t,{variant:"body2",color:"text.secondary",children:s.region||"N/A"})}),e.jsx(i,{children:e.jsx(t,{variant:"body2",color:"text.secondary",children:s.ageGroup||"N/A"})}),e.jsx(i,{children:s.url?e.jsx(t,{variant:"body2",color:"primary",component:"a",href:s.url,target:"_blank",rel:"noopener noreferrer",sx:{textDecoration:"none","&:hover":{textDecoration:"underline"}},children:"View League"}):e.jsx(t,{variant:"body2",color:"text.secondary",children:"No URL"})}),e.jsx(i,{children:e.jsx(t,{variant:"body2",color:"text.secondary",children:s.description||"No description"})}),e.jsxs(i,{align:"center",children:[e.jsx(U,{color:"primary",onClick:()=>fe(s),size:"small",children:e.jsx(Me,{})}),e.jsx(U,{color:"error",onClick:()=>pe(typeof s.id=="string"?parseInt(s.id):s.id),size:"small",children:e.jsx(Ue,{})})]})]},s.id)),G.length===0&&e.jsx(q,{children:e.jsx(i,{colSpan:3,align:"center",sx:{py:4},children:e.jsx(t,{variant:"body2",color:"text.secondary",children:"No leagues found. Create your first league to get started."})})})]})]})})]}),S===1&&e.jsxs(n,{children:[e.jsx(t,{variant:"h5",component:"h2",sx:{mb:2},children:"User Testing (Impersonation)"}),e.jsx(t,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Test the platform from different user perspectives without creating separate accounts."}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(p,{sx:{height:"100%",transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-4px)",boxShadow:4}},children:[e.jsxs(b,{sx:{textAlign:"center",pb:1},children:[e.jsx(N,{sx:{fontSize:48,color:"info.main",mb:2}}),e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Player"}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Test player features like availability posting and team searching"})]}),e.jsx(Q,{sx:{px:2,pb:2},children:e.jsx(r,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(N,{}),onClick:()=>I("Player"),disabled:j,children:"Test as Player"})})]})}),e.jsx(c,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(p,{sx:{height:"100%",transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-4px)",boxShadow:4}},children:[e.jsxs(b,{sx:{textAlign:"center",pb:1},children:[e.jsx(H,{sx:{fontSize:48,color:"warning.main",mb:2}}),e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Coach"}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Test coach features like team management and player recruitment"})]}),e.jsx(Q,{sx:{px:2,pb:2},children:e.jsx(r,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(H,{}),onClick:()=>I("Coach"),disabled:j,children:"Test as Coach"})})]})}),e.jsx(c,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(p,{sx:{height:"100%",transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-4px)",boxShadow:4}},children:[e.jsxs(b,{sx:{textAlign:"center",pb:1},children:[e.jsx(R,{sx:{fontSize:48,color:"success.main",mb:2}}),e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Parent"}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Test parent features for managing children's football activities"})]}),e.jsx(Q,{sx:{px:2,pb:2},children:e.jsx(r,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(R,{}),onClick:()=>I("Parent/Guardian"),disabled:j,children:"Test as Parent"})})]})})]})]}),S===2&&e.jsxs(n,{children:[e.jsx(t,{variant:"h5",component:"h2",sx:{mb:3},children:"System Settings"}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(p,{children:e.jsxs(b,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(z,{sx:{mr:2,color:"primary.main"}}),e.jsx(t,{variant:"h6",children:"Create Admin User"})]}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Create a new administrator account with full system access."}),e.jsx(r,{variant:"outlined",startIcon:e.jsx(z,{}),onClick:()=>C(!0),fullWidth:!0,children:"Create Admin Account"})]})})}),e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(p,{children:e.jsxs(b,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(ze,{sx:{mr:2,color:"success.main"}}),e.jsx(t,{variant:"h6",children:"Site Activity & Traffic"})]}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"View platform activity, user growth, and recent site traffic."}),e.jsx(Oe,{})]})})})]})]})]})]}),P&&e.jsx(He,{color:"primary","aria-label":"add",sx:{position:"fixed",bottom:16,right:16,zIndex:1e3},onClick:S===0?ee:()=>C(!0),children:e.jsx(te,{})})]}),e.jsxs(ne,{open:de,onClose:()=>v(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(re,{children:f?"Edit League":"Create New League"}),e.jsxs(ae,{children:[e.jsx(g,{autoFocus:!0,margin:"dense",label:"League Name",type:"text",fullWidth:!0,variant:"outlined",value:l.name,onChange:s=>h({...l,name:s.target.value}),sx:{mb:2}}),e.jsx(g,{margin:"dense",label:"Region",type:"text",fullWidth:!0,variant:"outlined",value:l.region,onChange:s=>h({...l,region:s.target.value}),sx:{mb:2}}),e.jsx(g,{margin:"dense",label:"Age Group",type:"text",fullWidth:!0,variant:"outlined",value:l.ageGroup,onChange:s=>h({...l,ageGroup:s.target.value}),sx:{mb:2}}),e.jsx(g,{margin:"dense",label:"League URL",type:"url",fullWidth:!0,variant:"outlined",value:l.url,onChange:s=>h({...l,url:s.target.value}),sx:{mb:2}}),e.jsx(g,{margin:"dense",label:"Description",type:"text",fullWidth:!0,variant:"outlined",multiline:!0,rows:3,value:l.description,onChange:s=>h({...l,description:s.target.value})})]}),e.jsxs(ie,{children:[e.jsx(r,{onClick:()=>v(!1),children:"Cancel"}),e.jsx(r,{onClick:f?je:me,variant:"contained",children:f?"Update":"Create"})]})]}),e.jsxs(ne,{open:he,onClose:()=>C(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(re,{children:"Create Admin User"}),e.jsxs(ae,{children:[e.jsx(g,{autoFocus:!0,margin:"dense",label:"Email",type:"email",fullWidth:!0,variant:"outlined",value:u.email,onChange:s=>T({...u,email:s.target.value}),sx:{mb:2}}),e.jsx(g,{margin:"dense",label:"First Name",type:"text",fullWidth:!0,variant:"outlined",value:u.firstName,onChange:s=>T({...u,firstName:s.target.value}),sx:{mb:2}}),e.jsx(g,{margin:"dense",label:"Last Name",type:"text",fullWidth:!0,variant:"outlined",value:u.lastName,onChange:s=>T({...u,lastName:s.target.value}),sx:{mb:2}}),e.jsx(g,{margin:"dense",label:"Password",type:"password",fullWidth:!0,variant:"outlined",value:u.password,onChange:s=>T({...u,password:s.target.value})})]}),e.jsxs(ie,{children:[e.jsx(r,{onClick:()=>C(!1),children:"Cancel"}),e.jsx(r,{onClick:ye,variant:"contained",children:"Create Admin"})]})]})]})};export{Je as default};
