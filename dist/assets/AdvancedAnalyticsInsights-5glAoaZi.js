import{av as ne,j as e,B as n,T as a,ck as W,a1 as re,a2 as ie,a3 as oe,i as u,X as le,Y as ce,s as T,cl as de,I as he,r as xe,L as E,G as l,z as y,bb as J,C as N,a as G,d as p,cm as me,cn as pe,bw as je,am as ue,an as ye,ao as ge,ap as H,aq as d,ar as fe,a6 as be,a7 as ve,a8 as Ce,n as Ie,as as Ae,at as B,k as D,ag as Se,l as R,aQ as we,e as M,a9 as ke,b5 as Te,au as Be,cd as L}from"./mui-vendor-C1HUv1lu.js";import{r as o}from"./react-vendor-BW_9WhSV.js";import{u as De,A as g,n as f}from"./admin-features-DSNbd77k.js";import{B as Re}from"./charts-vendor-DPNYAcQ3.js";const Oe=()=>{const h=ne(),{user:Y}=De(),[P,b]=o.useState([]),[x,v]=o.useState([]),[z,C]=o.useState([]),[F,I]=o.useState([]),[O,U]=o.useState(!1),[r,Z]=o.useState(null),[_,A]=o.useState(!1),[m]=o.useState({start:new Date(Date.now()-30*24*60*60*1e3),end:new Date}),[S,q]=o.useState("comprehensive"),[w,Q]=o.useState(!0);o.useEffect(()=>{if(k(),w){const s=setInterval(k,3e5);return()=>clearInterval(s)}},[m,S,w]);const k=async()=>{U(!0);try{await Promise.all([V(),X(),K(),ee()])}catch(s){console.error("Failed to load analytics insights:",s)}finally{U(!1)}},V=async()=>{try{const s=await fetch(`${g}/analytics/insights`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`,...f},body:JSON.stringify({dateRange:m,analysisType:S,userId:Y?.id})});if(s.ok){const t=await s.json();b(t)}else console.error("Analytics insights API failed:",s.status),b([])}catch(s){console.error("Failed to load insights:",s),b([])}},X=async()=>{try{const s=await fetch(`${g}/analytics/funnel`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`,...f},body:JSON.stringify({steps:[{name:"Landing Page"},{name:"Registration"},{name:"Profile Setup"},{name:"First Action"},{name:"Return Visit"}],period:m})});if(s.ok){const t=await s.json();v(t)}else console.error("Funnel analysis API failed:",s.status),v([])}catch(s){console.error("Failed to load funnel analysis:",s),v([])}},K=async()=>{try{const s=await fetch(`${g}/analytics/cohort`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`,...f},body:JSON.stringify({period:"weekly",metric:"retention"})});if(s.ok){const t=await s.json();C(t)}else console.error("Cohort analysis API failed:",s.status),C([])}catch(s){console.error("Failed to load cohort analysis:",s),C([])}},ee=async()=>{try{const s=await fetch(`${g}/analytics/segments`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`,...f},body:JSON.stringify({period:m})});if(s.ok){const t=await s.json();I(t)}else console.error("User segmentation API failed:",s.status),I([])}catch(s){console.error("Failed to load user segmentation:",s),I([])}},$=s=>{switch(s){case"trend":return e.jsx(M,{});case"anomaly":return e.jsx(Be,{});case"prediction":return e.jsx(J,{});case"recommendation":return e.jsx(Te,{});default:return e.jsx(W,{})}},j=(s,t)=>s==="anomaly"?"warning":t==="high"?"error":t==="medium"?"info":"success",se=()=>{const s=x.map(i=>i.name),t=x.map(i=>i.users),c=x.map(i=>i.conversionRate);return{labels:s,datasets:[{label:"Users",data:t,backgroundColor:L(h.palette.primary.main,.8),borderColor:h.palette.primary.main,borderWidth:1},{label:"Conversion Rate (%)",data:c,type:"line",borderColor:h.palette.secondary.main,backgroundColor:L(h.palette.secondary.main,.1),yAxisID:"y1",tension:.4}]}},te=()=>z.map(s=>e.jsxs(H,{children:[e.jsx(d,{children:s.cohort}),e.jsx(d,{children:s.size}),s.retention.map((t,c)=>e.jsxs(d,{sx:{backgroundColor:L(h.palette.primary.main,t/100*.8+.1),color:t>50?"white":"text.primary"},children:[t.toFixed(0),"%"]},c))]},s.cohort)),ae=()=>{const s={insights:P,funnelData:x,cohortData:z,userSegments:F,generatedAt:new Date().toISOString(),dateRange:m},t=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),c=URL.createObjectURL(t),i=document.createElement("a");i.href=c,i.download=`analytics-insights-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(c)};return e.jsxs(n,{sx:{p:3},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(a,{variant:"h4",fontWeight:"bold",children:[e.jsx(W,{sx:{mr:1,verticalAlign:"middle"}}),"Advanced Analytics Insights"]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(re,{size:"small",sx:{minWidth:150},children:[e.jsx(ie,{children:"Analysis Type"}),e.jsxs(oe,{value:S,onChange:s=>q(s.target.value),label:"Analysis Type",children:[e.jsx(u,{value:"comprehensive",children:"Comprehensive"}),e.jsx(u,{value:"behavioral",children:"User Behavior"}),e.jsx(u,{value:"performance",children:"Performance"}),e.jsx(u,{value:"business",children:"Business Metrics"})]})]}),e.jsx(le,{control:e.jsx(ce,{checked:w,onChange:s=>Q(s.target.checked)}),label:"Auto Refresh"}),e.jsx(T,{variant:"outlined",startIcon:e.jsx(de,{}),onClick:ae,children:"Export"}),e.jsx(he,{onClick:k,disabled:O,children:e.jsx(xe,{})})]})]}),O&&e.jsx(E,{sx:{mb:2}}),e.jsxs(l,{container:!0,spacing:3,children:[e.jsx(l,{item:!0,xs:12,lg:6,children:e.jsxs(y,{sx:{p:3,height:500,overflow:"hidden"},children:[e.jsxs(a,{variant:"h6",gutterBottom:!0,children:[e.jsx(J,{sx:{mr:1,verticalAlign:"middle"}}),"AI-Powered Insights"]}),e.jsx(n,{sx:{height:420,overflow:"auto"},children:P.map(s=>e.jsx(N,{sx:{mb:2,cursor:"pointer",transition:"transform 0.2s","&:hover":{transform:"translateY(-2px)"}},onClick:()=>{Z(s),A(!0)},children:e.jsx(G,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(n,{sx:{color:j(s.type,s.impact)+".main"},children:$(s.type)}),e.jsxs(n,{sx:{flexGrow:1},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(a,{variant:"subtitle1",fontWeight:"bold",children:s.title}),e.jsx(p,{label:`${s.confidence}% confidence`,size:"small",color:s.confidence>80?"success":"warning"}),e.jsx(p,{label:s.impact,size:"small",color:j(s.type,s.impact)})]}),e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:1},children:s.description}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(p,{label:s.category,size:"small",variant:"outlined"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:new Date(s.timestamp).toLocaleDateString()})]})]})]})})},s.id))})]})}),e.jsx(l,{item:!0,xs:12,lg:6,children:e.jsxs(y,{sx:{p:3,height:500},children:[e.jsxs(a,{variant:"h6",gutterBottom:!0,children:[e.jsx(me,{sx:{mr:1,verticalAlign:"middle"}}),"Conversion Funnel Analysis"]}),e.jsx(n,{sx:{height:350},children:x.length>0&&e.jsx(Re,{data:se(),options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!1}},scales:{y:{type:"linear",display:!0,position:"left",beginAtZero:!0},y1:{type:"linear",display:!0,position:"right",beginAtZero:!0,max:100,grid:{drawOnChartArea:!1}}}}})}),e.jsx(n,{sx:{mt:2},children:e.jsx(a,{variant:"caption",color:"text.secondary",children:"Identify conversion bottlenecks and optimization opportunities"})})]})}),e.jsx(l,{item:!0,xs:12,lg:8,children:e.jsxs(y,{sx:{p:3},children:[e.jsxs(a,{variant:"h6",gutterBottom:!0,children:[e.jsx(pe,{sx:{mr:1,verticalAlign:"middle"}}),"User Segmentation Analysis"]}),e.jsx(l,{container:!0,spacing:3,children:F.map(s=>e.jsx(l,{item:!0,xs:12,md:4,children:e.jsx(N,{variant:"outlined",children:e.jsxs(G,{children:[e.jsx(a,{variant:"h6",color:"primary",gutterBottom:!0,children:s.name}),e.jsx(a,{variant:"h4",sx:{mb:1},children:s.size}),e.jsx(a,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:"users in segment"}),e.jsxs(n,{sx:{mb:2},children:[e.jsx(a,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Characteristics:"}),s.characteristics.map((t,c)=>e.jsx(p,{label:t,size:"small",sx:{mr:.5,mb:.5}},c))]}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",mt:2},children:[e.jsxs(n,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",children:"Conversion Rate"}),e.jsxs(a,{variant:"h6",color:"primary",children:[s.conversionRate,"%"]})]}),e.jsxs(n,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",children:"Avg Session"}),e.jsxs(a,{variant:"h6",color:"primary",children:[Math.floor(s.avgSessionDuration/60),"m"]})]})]})]})})},s.name))})]})}),e.jsx(l,{item:!0,xs:12,lg:4,children:e.jsxs(y,{sx:{p:3,height:400,overflow:"hidden"},children:[e.jsxs(a,{variant:"h6",gutterBottom:!0,children:[e.jsx(je,{sx:{mr:1,verticalAlign:"middle"}}),"Cohort Retention"]}),e.jsx(ue,{sx:{height:320},children:e.jsxs(ye,{size:"small",stickyHeader:!0,children:[e.jsx(ge,{children:e.jsxs(H,{children:[e.jsx(d,{children:"Cohort"}),e.jsx(d,{children:"Size"}),Array.from({length:8},(s,t)=>e.jsxs(d,{children:["W",t]},t))]})}),e.jsx(fe,{children:te()})]})})]})})]}),e.jsxs(be,{open:_,onClose:()=>A(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(ve,{children:r&&e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[$(r.type),r.title]})}),e.jsx(Ce,{children:r&&e.jsxs(n,{children:[e.jsx(Ie,{severity:j(r.type,r.impact),children:e.jsx(a,{variant:"body1",children:r.description})}),e.jsxs(n,{sx:{mt:3},children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Details"}),e.jsxs(l,{container:!0,spacing:2,children:[e.jsxs(l,{item:!0,xs:6,children:[e.jsx(a,{variant:"body2",color:"text.secondary",children:"Confidence Level"}),e.jsx(E,{variant:"determinate",value:r.confidence,sx:{mt:1,mb:1}}),e.jsxs(a,{variant:"body2",children:[r.confidence,"%"]})]}),e.jsxs(l,{item:!0,xs:6,children:[e.jsx(a,{variant:"body2",color:"text.secondary",children:"Impact Level"}),e.jsx(p,{label:r.impact.toUpperCase(),color:j(r.type,r.impact),sx:{mt:1}})]})]})]}),r.actionable&&e.jsxs(n,{sx:{mt:3},children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Recommended Actions"}),e.jsxs(Ae,{children:[e.jsxs(B,{children:[e.jsx(D,{children:e.jsx(Se,{color:"success"})}),e.jsx(R,{primary:"Monitor the trend for the next 7 days"})]}),e.jsxs(B,{children:[e.jsx(D,{children:e.jsx(we,{color:"info"})}),e.jsx(R,{primary:"Analyze user feedback for related patterns"})]}),e.jsxs(B,{children:[e.jsx(D,{children:e.jsx(M,{color:"primary"})}),e.jsx(R,{primary:"Consider A/B testing related features"})]})]})]})]})}),e.jsxs(ke,{children:[e.jsx(T,{onClick:()=>A(!1),children:"Close"}),r?.actionable&&e.jsx(T,{variant:"contained",children:"Take Action"})]})]})]})};export{Oe as default};
