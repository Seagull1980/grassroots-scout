import{j as e,b9 as D,B as r,y as S,T as a,s as d,r as R,z as B,a6 as $,a7 as F,a8 as N,a0 as P,a9 as W,C as G,a as O,G as m,x as Y,aG as H,f as q,v as J,n as K,d as Q,cc as U,ac as V,I as X,ab as Z}from"./mui-vendor-C1HUv1lu.js";import{r as l}from"./react-vendor-BW_9WhSV.js";import{u as _,a as j}from"./admin-features-DSNbd77k.js";const ne=()=>{const{user:T}=_(),[y,h]=l.useState([]),[w,f]=l.useState(!0),[n,x]=l.useState({open:!1,invitation:null,status:null}),[g,p]=l.useState(""),[o,v]=l.useState(!1),c=T?.role==="Coach";l.useEffect(()=>{b()},[]);const b=async()=>{try{f(!0);const t=c?"sent":"received",s=await j.get(`/training-invitations?type=${t}`);s.data.success&&h(s.data.invitations)}catch(t){console.error("Error fetching training invitations:",t)}finally{f(!1)}},C=(t,s)=>{x({open:!0,invitation:t,status:s}),p("")},k=async()=>{if(!(!n.invitation||!n.status))try{v(!0),(await j.put(`/training-invitations/${n.invitation.id}`,{status:n.status,responseMessage:g.trim()||void 0})).data.success&&(h(s=>s.map(i=>i.id===n.invitation.id?{...i,status:n.status,responseMessage:g.trim()}:i)),x({open:!1,invitation:null,status:null}),p(""),alert(`Training invitation ${n.status} successfully!`))}catch(t){console.error("Error responding to training invitation:",t);const s=t.response?.data?.error||"Failed to respond to invitation";alert(s)}finally{v(!1)}},A=async t=>{if(confirm("Are you sure you want to cancel this training invitation?"))try{(await j.delete(`/training-invitations/${t}`)).data.success&&(h(i=>i.filter(M=>M.id!==t)),alert("Training invitation cancelled successfully"))}catch(s){console.error("Error cancelling training invitation:",s);const i=s.response?.data?.error||"Failed to cancel invitation";alert(i)}},u=t=>new Date(t).toLocaleDateString(),I=t=>t.substring(0,5),z=t=>{switch(t){case"pending":return"warning";case"accepted":return"success";case"declined":return"error";case"expired":return"default";default:return"default"}},E=t=>new Date>new Date(t),L=t=>{const s=E(t.expiresAt),i=t.status==="pending"&&!s;return e.jsx(G,{sx:{mb:2},children:e.jsxs(O,{children:[e.jsxs(m,{container:!0,spacing:2,children:[e.jsxs(m,{item:!0,xs:12,sm:8,children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:t.teamName}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(Y,{fontSize:"small",sx:{mr:1,color:"text.secondary"}}),e.jsx(a,{variant:"body2",color:"text.secondary",children:t.trainingLocation})]}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(H,{fontSize:"small",sx:{mr:1,color:"text.secondary"}}),e.jsx(a,{variant:"body2",color:"text.secondary",children:u(t.trainingDate)}),e.jsx(q,{fontSize:"small",sx:{ml:2,mr:1,color:"text.secondary"}}),e.jsx(a,{variant:"body2",color:"text.secondary",children:I(t.trainingTime)})]}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(J,{fontSize:"small",sx:{mr:1,color:"text.secondary"}}),e.jsx(a,{variant:"body2",color:"text.secondary",children:c?`${t.playerFirstName} ${t.playerLastName}`:`${t.coachFirstName} ${t.coachLastName}`})]}),t.message&&e.jsxs(a,{variant:"body2",sx:{mt:1,fontStyle:"italic"},children:['"',t.message,'"']}),t.responseMessage&&e.jsx(K,{severity:"info",sx:{mt:1},children:e.jsxs(a,{variant:"body2",children:[e.jsx("strong",{children:"Response:"})," ",t.responseMessage]})})]}),e.jsx(m,{item:!0,xs:12,sm:4,children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",height:"100%"},children:[e.jsx(Q,{label:s&&t.status==="pending"?"Expired":t.status,color:z(s&&t.status==="pending"?"expired":t.status),sx:{mb:2}}),!c&&i&&e.jsxs(r,{sx:{display:"flex",gap:1,mt:"auto"},children:[e.jsx(d,{variant:"contained",color:"success",size:"small",startIcon:e.jsx(U,{}),onClick:()=>C(t,"accepted"),children:"Accept"}),e.jsx(d,{variant:"outlined",color:"error",size:"small",startIcon:e.jsx(V,{}),onClick:()=>C(t,"declined"),children:"Decline"})]}),c&&t.status==="pending"&&!s&&e.jsx(X,{color:"error",size:"small",onClick:()=>A(t.id),sx:{mt:"auto"},children:e.jsx(Z,{})})]})})]}),e.jsx(r,{sx:{mt:2,pt:1,borderTop:"1px solid #eee"},children:e.jsxs(a,{variant:"caption",color:"text.secondary",children:["Sent: ",u(t.createdAt),!s&&t.status==="pending"&&e.jsxs(e.Fragment,{children:[" â€¢ Expires: ",u(t.expiresAt)]})]})})]})},t.id)};return w?e.jsx(D,{maxWidth:"lg",sx:{mt:4,mb:4},children:e.jsx(r,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"300px",children:e.jsx(S,{})})}):e.jsxs(D,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(a,{variant:"h4",component:"h1",children:"Training Invitations"}),e.jsx(d,{variant:"outlined",startIcon:e.jsx(R,{}),onClick:b,children:"Refresh"})]}),y.length===0?e.jsxs(B,{sx:{p:4,textAlign:"center"},children:[e.jsx(a,{variant:"h6",color:"text.secondary",children:c?"You haven't sent any training invitations yet.":"You haven't received any training invitations yet."}),e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mt:1},children:c?"Start connecting with players through the search page and send them training invites!":"Coaches will send you training invitations when they're interested in your profile."})]}):e.jsx(r,{children:y.map(t=>L(t))}),e.jsxs($,{open:n.open,onClose:()=>!o&&x({open:!1,invitation:null,status:null}),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(F,{children:[n.status==="accepted"?"Accept":"Decline"," Training Invitation"]}),e.jsx(N,{children:n.invitation&&e.jsxs(r,{children:[e.jsxs(a,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Team:"})," ",n.invitation.teamName]}),e.jsxs(a,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Date & Time:"})," ",u(n.invitation.trainingDate)," at ",I(n.invitation.trainingTime)]}),e.jsxs(a,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Location:"})," ",n.invitation.trainingLocation]}),e.jsx(P,{fullWidth:!0,label:"Response Message (Optional)",multiline:!0,rows:3,value:g,onChange:t=>p(t.target.value),sx:{mt:2},placeholder:n.status==="accepted"?"Thank you for the invitation! I'm looking forward to training with the team.":"Thank you for considering me, but I won't be able to attend at this time.",inputProps:{maxLength:300},disabled:o})]})}),e.jsxs(W,{children:[e.jsx(d,{onClick:()=>x({open:!1,invitation:null,status:null}),disabled:o,children:"Cancel"}),e.jsx(d,{onClick:k,variant:"contained",color:n.status==="accepted"?"success":"error",disabled:o,startIcon:o?e.jsx(S,{size:16}):null,children:o?"Submitting...":n.status==="accepted"?"Accept Invitation":"Decline Invitation"})]})]})]})};export{ne as default};
