import{j as e,ae,B as o,T as r,v as m,w as re,i as G,k as se,l as oe,m as W,G as v,C as M,a as z,d as y,am as ne,bf as k,cg as A,X as le,I as ie,ap as ce,ch as de,J as F,K as $,N as E,O as d,Q as O,ci as ue,U as he,aw as xe}from"./mui-vendor-rZ0WLTig.js";import{r as l}from"./react-vendor-CRXLTmIH.js";import{u as me}from"./admin-features-d6LVy8Ft.js";function R(u){const{children:p,value:f,index:h,...w}=u;return e.jsx("div",{role:"tabpanel",hidden:f!==h,id:`match-completions-tabpanel-${h}`,"aria-labelledby":`match-completions-tab-${h}`,...w,children:f===h&&e.jsx(o,{sx:{p:3},children:p})})}const je=()=>{const{user:u}=me(),[p,f]=l.useState(0),[h,w]=l.useState([]),[pe,B]=l.useState(!0),[L,i]=l.useState(""),[U,j]=l.useState(""),[q,C]=l.useState(!1),[Y,b]=l.useState(!1),[I,J]=l.useState(null),[a,x]=l.useState({matchType:u?.role==="Parent/Guardian"?"child_to_team":"player_to_team",playerName:"",teamName:"",position:"",ageGroup:"",league:"",startDate:""}),[n,g]=l.useState({successStory:"",rating:0,feedback:"",publicStory:!1});l.useEffect(()=>{S()},[]);const S=async()=>{try{B(!0);const t=localStorage.getItem("token"),s=await fetch("/api/match-completions",{headers:{Authorization:`Bearer ${t}`}});if(s.ok){const c=await s.json();w(c.completions)}else i("Failed to fetch match completions")}catch{i("Network error occurred")}finally{B(!1)}},V=async()=>{try{const t=localStorage.getItem("token"),s=await fetch("/api/match-completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(a)});if(s.ok)j("Match completion created successfully!"),C(!1),x({matchType:u?.role==="Parent/Guardian"?"child_to_team":"player_to_team",playerName:"",teamName:"",position:"",ageGroup:"",league:"",startDate:""}),S();else{const c=await s.json();i(c.error||"Failed to create match completion")}}catch{i("Network error occurred")}},_=async(t,s)=>{try{const c=localStorage.getItem("token"),P=await fetch(`/api/match-completions/${t}/confirm`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({confirmed:s})});if(P.ok){const T=await P.json();j(T.allConfirmed?"Match confirmed! Both parties have agreed.":"Your confirmation has been recorded."),S()}else{const T=await P.json();i(T.error||"Failed to confirm match")}}catch{i("Network error occurred")}},K=async()=>{if(I)try{const t=localStorage.getItem("token"),s=await fetch(`/api/match-completions/${I.id}/story`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(n)});if(s.ok)j("Success story updated!"),b(!1),S();else{const c=await s.json();i(c.error||"Failed to update success story")}}catch{i("Network error occurred")}},Q=t=>{J(t),g({successStory:t.successStory||"",rating:t.rating||0,feedback:t.feedback||"",publicStory:t.publicStory}),b(!0)},X=t=>t.completionStatus==="confirmed"?"success":t.completionStatus==="declined"?"error":"warning",H=t=>t.completionStatus==="confirmed"?e.jsx(k,{}):e.jsx(A,{}),D=h.filter(t=>t.completionStatus==="pending"),N=h.filter(t=>t.completionStatus==="confirmed"),Z=["Goalkeeper","Defender","Midfielder","Forward","Centre-Back","Full-Back","Wing-Back","Defensive Midfielder","Central Midfielder","Attacking Midfielder","Winger","Striker"],ee=["Under 6","Under 7","Under 8","Under 9","Under 10","Under 11","Under 12","Under 13","Under 14","Under 15","Under 16","Under 17","Under 18","Under 21","Adult (18+)","Veterans (35+)"],te=["Premier League Youth","Championship Youth","League One Youth","National League Youth","County League","District League","Local Sunday League","School Football League","Academy League"];return e.jsx(ae,{maxWidth:"lg",children:e.jsxs(o,{sx:{py:4},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(r,{variant:"h4",component:"h1",children:"Match Completions"}),e.jsx(m,{variant:"contained",startIcon:e.jsx(re,{}),onClick:()=>C(!0),children:"Report New Match"})]}),L&&e.jsx(G,{severity:"error",sx:{mb:2},onClose:()=>i(""),children:L}),U&&e.jsx(G,{severity:"success",sx:{mb:2},onClose:()=>j(""),children:U}),e.jsxs(se,{sx:{width:"100%"},children:[e.jsxs(oe,{value:p,onChange:(t,s)=>f(s),children:[e.jsx(W,{label:`Pending (${D.length})`}),e.jsx(W,{label:`Confirmed (${N.length})`})]}),e.jsxs(R,{value:p,index:0,children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Pending Confirmations"}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"These matches need confirmation from both the coach and player/parent."}),D.length===0?e.jsx(r,{variant:"body1",color:"text.secondary",children:"No pending match confirmations."}):e.jsx(v,{container:!0,spacing:2,children:D.map(t=>e.jsx(v,{item:!0,xs:12,md:6,children:e.jsx(M,{children:e.jsxs(z,{children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[e.jsx(y,{icon:H(t),label:t.completionStatus.toUpperCase(),color:X(t),size:"small"}),e.jsx(r,{variant:"caption",color:"text.secondary",children:new Date(t.createdAt).toLocaleDateString()})]}),e.jsxs(r,{variant:"h6",gutterBottom:!0,children:[t.playerName," → ",t.teamName]}),e.jsxs(r,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Position: ",t.position," | Age Group: ",t.ageGroup]}),e.jsxs(r,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["League: ",t.league]}),e.jsx(ne,{sx:{my:2}}),e.jsxs(o,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(y,{label:"Coach",color:t.coachConfirmed?"success":"default",size:"small",icon:t.coachConfirmed?e.jsx(k,{}):e.jsx(A,{})}),e.jsx(y,{label:t.matchType==="child_to_team"?"Parent":"Player",color:t.matchType==="child_to_team"?t.parentConfirmed?"success":"default":t.playerConfirmed?"success":"default",size:"small",icon:(t.matchType==="child_to_team"?t.parentConfirmed:t.playerConfirmed)?e.jsx(k,{}):e.jsx(A,{})})]}),(u?.role==="Coach"&&!t.coachConfirmed||u?.role==="Player"&&!t.playerConfirmed||u?.role==="Parent/Guardian"&&!t.parentConfirmed)&&e.jsxs(o,{sx:{display:"flex",gap:1},children:[e.jsx(m,{variant:"contained",color:"success",size:"small",onClick:()=>_(t.id,!0),children:"Confirm Match"}),e.jsx(m,{variant:"outlined",color:"error",size:"small",onClick:()=>_(t.id,!1),children:"Decline"})]})]})})},t.id))})]}),e.jsxs(R,{value:p,index:1,children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Confirmed Matches"}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Successfully completed matches. Add your success story and rating!"}),N.length===0?e.jsx(r,{variant:"body1",color:"text.secondary",children:"No confirmed matches yet."}):e.jsx(v,{container:!0,spacing:2,children:N.map(t=>e.jsx(v,{item:!0,xs:12,md:6,children:e.jsx(M,{children:e.jsxs(z,{children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[e.jsx(y,{icon:e.jsx(k,{}),label:"CONFIRMED",color:"success",size:"small"}),e.jsxs(o,{sx:{display:"flex",gap:1},children:[e.jsx(le,{title:"Add/Edit Success Story",children:e.jsx(ie,{size:"small",onClick:()=>Q(t),children:e.jsx(ce,{})})}),t.rating&&e.jsxs(o,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(de,{color:"warning",fontSize:"small"}),e.jsx(r,{variant:"caption",children:t.rating})]})]})]}),e.jsxs(r,{variant:"h6",gutterBottom:!0,children:[t.playerName," → ",t.teamName]}),e.jsxs(r,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Position: ",t.position," | Age Group: ",t.ageGroup]}),e.jsxs(r,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["League: ",t.league]}),t.completedAt&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Completed: ",new Date(t.completedAt).toLocaleDateString()]}),t.successStory&&e.jsxs(o,{sx:{mt:2,p:2,bgcolor:"grey.50",borderRadius:1},children:[e.jsxs(r,{variant:"body2",children:['"',t.successStory,'"']}),t.publicStory&&e.jsx(y,{label:"Public Story",size:"small",color:"primary",sx:{mt:1}})]})]})})},t.id))})]})]}),e.jsxs(F,{open:q,onClose:()=>C(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx($,{children:"Report New Match"}),e.jsx(E,{children:e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e.jsx(d,{label:"Player Name",value:a.playerName,onChange:t=>x({...a,playerName:t.target.value}),fullWidth:!0,required:!0}),e.jsx(d,{label:"Team Name",value:a.teamName,onChange:t=>x({...a,teamName:t.target.value}),fullWidth:!0,required:!0}),e.jsxs(d,{select:!0,label:"Position",value:a.position,onChange:t=>x({...a,position:t.target.value}),fullWidth:!0,required:!0,SelectProps:{native:!0},children:[e.jsx("option",{value:"",children:"Select Position"}),Z.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs(d,{select:!0,label:"Age Group",value:a.ageGroup,onChange:t=>x({...a,ageGroup:t.target.value}),fullWidth:!0,required:!0,SelectProps:{native:!0},children:[e.jsx("option",{value:"",children:"Select Age Group"}),ee.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs(d,{select:!0,label:"League",value:a.league,onChange:t=>x({...a,league:t.target.value}),fullWidth:!0,required:!0,SelectProps:{native:!0},children:[e.jsx("option",{value:"",children:"Select League"}),te.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx(d,{label:"Start Date",type:"date",value:a.startDate,onChange:t=>x({...a,startDate:t.target.value}),fullWidth:!0,InputLabelProps:{shrink:!0}})]})}),e.jsxs(O,{children:[e.jsx(m,{onClick:()=>C(!1),children:"Cancel"}),e.jsx(m,{onClick:V,variant:"contained",disabled:!a.playerName||!a.teamName||!a.position||!a.ageGroup||!a.league,children:"Create"})]})]}),e.jsxs(F,{open:Y,onClose:()=>b(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx($,{children:"Add Success Story"}),e.jsx(E,{children:e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e.jsx(d,{label:"Success Story",value:n.successStory,onChange:t=>g({...n,successStory:t.target.value}),fullWidth:!0,multiline:!0,rows:4,placeholder:"Tell us about this successful match...",inputProps:{maxLength:1e3},helperText:`${n.successStory.length}/1000 characters`}),e.jsxs(o,{children:[e.jsx(r,{component:"legend",children:"Rate this experience"}),e.jsx(ue,{value:n.rating,onChange:(t,s)=>g({...n,rating:s||0})})]}),e.jsx(d,{label:"Additional Feedback",value:n.feedback,onChange:t=>g({...n,feedback:t.target.value}),fullWidth:!0,multiline:!0,rows:2,placeholder:"Any additional feedback...",inputProps:{maxLength:500},helperText:`${n.feedback.length}/500 characters`}),e.jsx(he,{control:e.jsx(xe,{checked:n.publicStory,onChange:t=>g({...n,publicStory:t.target.checked})}),label:"Share this story publicly to inspire others"})]})}),e.jsxs(O,{children:[e.jsx(m,{onClick:()=>b(!1),children:"Cancel"}),e.jsx(m,{onClick:K,variant:"contained",children:"Save Story"})]})]})]})})};export{je as default};
