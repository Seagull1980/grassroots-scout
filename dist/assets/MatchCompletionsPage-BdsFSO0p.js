import{j as t,b8 as le,B as o,T as r,s as m,af as ie,n as W,z as ce,ah as de,ai as z,G as v,C as $,a as F,d as y,H as ue,ag as k,c4 as T,g as he,I as xe,N as me,c5 as pe,a6 as R,a7 as E,a8 as O,a0 as u,$ as ge,a9 as q,c6 as fe,X as ye,a5 as je}from"./mui-vendor-JAsu9f5S.js";import{r as l}from"./react-vendor-BTglNIF_.js";import{u as Ce}from"./admin-features-R-myf6Sn.js";import{u as be,a as Se}from"./index-BQAk7Te6.js";import"./analytics-features-CxqOf8yP.js";import"./maps-features-CosVVne9.js";import"./maps-vendor-5en1VuuU.js";function J(h){const{children:w,value:p,index:d,...D}=h;return t.jsx("div",{role:"tabpanel",hidden:p!==d,id:`match-completions-tabpanel-${d}`,"aria-labelledby":`match-completions-tab-${d}`,...D,children:p===d&&t.jsx(o,{sx:{p:3},children:w})})}const Te=()=>{const{user:h}=Ce(),{isMobile:w}=be(),{containerSpacing:p}=Se(),[d,D]=l.useState(0),[L,H]=l.useState([]),[B,V]=l.useState([]),[X,I]=l.useState(!1),[G,c]=l.useState(""),[U,j]=l.useState(""),[Y,C]=l.useState(!1),[K,b]=l.useState(!1),[_,Q]=l.useState(null),[s,x]=l.useState({matchType:h?.role==="Parent/Guardian"?"child_to_team":"player_to_team",playerName:"",teamName:"",position:"",ageGroup:"",league:"",startDate:""}),[i,g]=l.useState({successStory:"",rating:0,feedback:"",publicStory:!1});l.useEffect(()=>{S(),Z()},[]);const Z=async()=>{try{I(!0);const e=await fetch("/api/leagues");if(e.ok){const a=await e.json();V(a.leagues||[])}else console.error("Failed to fetch leagues")}catch(e){console.error("Error fetching leagues:",e)}finally{I(!1)}},S=async()=>{try{const e=localStorage.getItem("token"),a=await fetch("/api/match-completions",{headers:{Authorization:`Bearer ${e}`}});if(a.ok){const n=await a.json();H(n.completions)}else c("Failed to fetch match completions")}catch{c("Network error occurred")}},ee=async()=>{try{const e=localStorage.getItem("token"),a=await fetch("/api/match-completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(s)});if(a.ok)j("Match completion created successfully!"),C(!1),x({matchType:h?.role==="Parent/Guardian"?"child_to_team":"player_to_team",playerName:"",teamName:"",position:"",ageGroup:"",league:"",startDate:""}),S();else{const n=await a.json();c(n.error||"Failed to create match completion")}}catch{c("Network error occurred")}},M=async(e,a)=>{try{const n=localStorage.getItem("token"),f=await fetch(`/api/match-completions/${e}/confirm`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({confirmed:a})});if(f.ok){const A=await f.json();j(A.allConfirmed?"Match confirmed! Both parties have agreed.":"Your confirmation has been recorded."),S()}else{const A=await f.json();c(A.error||"Failed to confirm match")}}catch{c("Network error occurred")}},te=async()=>{if(_)try{const e=localStorage.getItem("token"),a=await fetch(`/api/match-completions/${_.id}/story`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(i)});if(a.ok)j("Success story updated!"),b(!1),S();else{const n=await a.json();c(n.error||"Failed to update success story")}}catch{c("Network error occurred")}},ae=e=>{Q(e),g({successStory:e.successStory||"",rating:e.rating||0,feedback:e.feedback||"",publicStory:e.publicStory}),b(!0)},re=e=>e.completionStatus==="confirmed"?"success":e.completionStatus==="declined"?"error":"warning",se=e=>e.completionStatus==="confirmed"?t.jsx(k,{}):t.jsx(T,{}),N=L.filter(e=>e.completionStatus==="pending"),P=L.filter(e=>e.completionStatus==="confirmed"),ne=["Goalkeeper","Defender","Midfielder","Forward","Centre-Back","Full-Back","Wing-Back","Defensive Midfielder","Central Midfielder","Attacking Midfielder","Winger","Striker"],oe=["Under 6","Under 7","Under 8","Under 9","Under 10","Under 11","Under 12","Under 13","Under 14","Under 15","Under 16","Under 17","Under 18","Under 21","Adult (18+)","Veterans (35+)"];return t.jsx(le,{maxWidth:"lg",sx:{px:w?1:3},children:t.jsxs(o,{sx:{py:4},children:[t.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[t.jsx(r,{variant:"h4",component:"h1",children:"Match Completions"}),t.jsx(m,{variant:"contained",startIcon:t.jsx(ie,{}),onClick:()=>C(!0),children:"Report New Match"})]}),G&&t.jsx(W,{severity:"error",sx:{mb:2},onClose:()=>c(""),children:G}),U&&t.jsx(W,{severity:"success",sx:{mb:2},onClose:()=>j(""),children:U}),t.jsxs(ce,{sx:{width:"100%"},children:[t.jsxs(de,{value:d,onChange:(e,a)=>D(a),children:[t.jsx(z,{label:`Pending (${N.length})`}),t.jsx(z,{label:`Confirmed (${P.length})`})]}),t.jsxs(J,{value:d,index:0,children:[t.jsx(r,{variant:"h6",gutterBottom:!0,children:"Pending Confirmations"}),t.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"These matches need confirmation from both the coach and player/parent."}),N.length===0?t.jsx(r,{variant:"body1",color:"text.secondary",children:"No pending match confirmations."}):t.jsx(v,{container:!0,spacing:p,children:N.map(e=>t.jsx(v,{item:!0,xs:12,md:6,children:t.jsx($,{children:t.jsxs(F,{children:[t.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[t.jsx(y,{icon:se(e),label:e.completionStatus.toUpperCase(),color:re(e),size:"small"}),t.jsx(r,{variant:"caption",color:"text.secondary",children:new Date(e.createdAt).toLocaleDateString()})]}),t.jsxs(r,{variant:"h6",gutterBottom:!0,children:[e.playerName," → ",e.teamName]}),t.jsxs(r,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Position: ",e.position," | Age Group: ",e.ageGroup]}),t.jsxs(r,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["League: ",e.league]}),t.jsx(ue,{sx:{my:2}}),t.jsxs(o,{sx:{display:"flex",gap:1,mb:2},children:[t.jsx(y,{label:"Coach",color:e.coachConfirmed?"success":"default",size:"small",icon:e.coachConfirmed?t.jsx(k,{}):t.jsx(T,{})}),t.jsx(y,{label:e.matchType==="child_to_team"?"Parent":"Player",color:e.matchType==="child_to_team"?e.parentConfirmed?"success":"default":e.playerConfirmed?"success":"default",size:"small",icon:(e.matchType==="child_to_team"?e.parentConfirmed:e.playerConfirmed)?t.jsx(k,{}):t.jsx(T,{})})]}),(h?.role==="Coach"&&!e.coachConfirmed||h?.role==="Player"&&!e.playerConfirmed||h?.role==="Parent/Guardian"&&!e.parentConfirmed)&&t.jsxs(o,{sx:{display:"flex",gap:1},children:[t.jsx(m,{variant:"contained",color:"success",size:"small",onClick:()=>M(e.id,!0),children:"Confirm Match"}),t.jsx(m,{variant:"outlined",color:"error",size:"small",onClick:()=>M(e.id,!1),children:"Decline"})]})]})})},e.id))})]}),t.jsxs(J,{value:d,index:1,children:[t.jsx(r,{variant:"h6",gutterBottom:!0,children:"Confirmed Matches"}),t.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Successfully completed matches. Add your success story and rating!"}),P.length===0?t.jsx(r,{variant:"body1",color:"text.secondary",children:"No confirmed matches yet."}):t.jsx(v,{container:!0,spacing:p,children:P.map(e=>t.jsx(v,{item:!0,xs:12,md:6,children:t.jsx($,{children:t.jsxs(F,{children:[t.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[t.jsx(y,{icon:t.jsx(k,{}),label:"CONFIRMED",color:"success",size:"small"}),t.jsxs(o,{sx:{display:"flex",gap:1},children:[t.jsx(he,{title:"Add/Edit Success Story",children:t.jsx(xe,{size:"small",onClick:()=>ae(e),children:t.jsx(me,{})})}),e.rating&&t.jsxs(o,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(pe,{color:"warning",fontSize:"small"}),t.jsx(r,{variant:"caption",children:e.rating})]})]})]}),t.jsxs(r,{variant:"h6",gutterBottom:!0,children:[e.playerName," → ",e.teamName]}),t.jsxs(r,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Position: ",e.position," | Age Group: ",e.ageGroup]}),t.jsxs(r,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["League: ",e.league]}),e.completedAt&&t.jsxs(r,{variant:"caption",color:"text.secondary",children:["Completed: ",new Date(e.completedAt).toLocaleDateString()]}),e.successStory&&t.jsxs(o,{sx:{mt:2,p:2,bgcolor:"grey.50",borderRadius:1},children:[t.jsxs(r,{variant:"body2",children:['"',e.successStory,'"']}),e.publicStory&&t.jsx(y,{label:"Public Story",size:"small",color:"primary",sx:{mt:1}})]})]})})},e.id))})]})]}),t.jsxs(R,{open:Y,onClose:()=>C(!1),maxWidth:"sm",fullWidth:!0,children:[t.jsx(E,{children:"Report New Match"}),t.jsx(O,{children:t.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[t.jsx(u,{label:"Player Name",value:s.playerName,onChange:e=>x({...s,playerName:e.target.value}),fullWidth:!0,required:!0}),t.jsx(u,{label:"Team Name",value:s.teamName,onChange:e=>x({...s,teamName:e.target.value}),fullWidth:!0,required:!0}),t.jsxs(u,{select:!0,label:"Position",value:s.position,onChange:e=>x({...s,position:e.target.value}),fullWidth:!0,required:!0,SelectProps:{native:!0},children:[t.jsx("option",{value:"",children:"Select Position"}),ne.map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsxs(u,{select:!0,label:"Age Group",value:s.ageGroup,onChange:e=>x({...s,ageGroup:e.target.value}),fullWidth:!0,required:!0,SelectProps:{native:!0},children:[t.jsx("option",{value:"",children:"Select Age Group"}),oe.map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsx(ge,{options:B,getOptionLabel:e=>e.name||"",value:B.find(e=>e.name===s.league)||null,onChange:(e,a)=>{x({...s,league:a?.name||""})},loading:X,renderInput:e=>t.jsx(u,{...e,label:"League",required:!0,fullWidth:!0}),renderOption:(e,a)=>{const{key:n,...f}=e;return t.jsx(o,{component:"li",...f,children:t.jsxs(o,{children:[t.jsx(r,{variant:"body1",children:a.name}),a.isPending&&t.jsx(r,{variant:"caption",color:"text.secondary",children:"Awaiting Admin Approval"})]})},n)},filterOptions:(e,{inputValue:a})=>e.filter(n=>n.name.toLowerCase().includes(a.toLowerCase())||n.region&&n.region.toLowerCase().includes(a.toLowerCase())||n.ageGroup&&n.ageGroup.toLowerCase().includes(a.toLowerCase()))}),t.jsx(u,{label:"Start Date",type:"date",value:s.startDate,onChange:e=>x({...s,startDate:e.target.value}),fullWidth:!0,InputLabelProps:{shrink:!0}})]})}),t.jsxs(q,{children:[t.jsx(m,{onClick:()=>C(!1),children:"Cancel"}),t.jsx(m,{onClick:ee,variant:"contained",disabled:!s.playerName||!s.teamName||!s.position||!s.ageGroup||!s.league,children:"Create"})]})]}),t.jsxs(R,{open:K,onClose:()=>b(!1),maxWidth:"sm",fullWidth:!0,children:[t.jsx(E,{children:"Add Success Story"}),t.jsx(O,{children:t.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[t.jsx(u,{label:"Success Story",value:i.successStory,onChange:e=>g({...i,successStory:e.target.value}),fullWidth:!0,multiline:!0,rows:4,placeholder:"Tell us about this successful match...",inputProps:{maxLength:1e3},helperText:`${i.successStory.length}/1000 characters`}),t.jsxs(o,{children:[t.jsx(r,{component:"legend",children:"Rate this experience"}),t.jsx(fe,{value:i.rating,onChange:(e,a)=>g({...i,rating:a||0})})]}),t.jsx(u,{label:"Additional Feedback",value:i.feedback,onChange:e=>g({...i,feedback:e.target.value}),fullWidth:!0,multiline:!0,rows:2,placeholder:"Any additional feedback...",inputProps:{maxLength:500},helperText:`${i.feedback.length}/500 characters`}),t.jsx(ye,{control:t.jsx(je,{checked:i.publicStory,onChange:e=>g({...i,publicStory:e.target.checked})}),label:"Share this story publicly to inspire others"})]})}),t.jsxs(q,{children:[t.jsx(m,{onClick:()=>b(!1),children:"Cancel"}),t.jsx(m,{onClick:te,variant:"contained",children:"Save Story"})]})]})]})})};export{Te as default};
