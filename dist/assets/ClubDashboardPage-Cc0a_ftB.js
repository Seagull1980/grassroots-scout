import{j as e,b9 as P,n as S,y as Se,b_ as we,bg as O,b$ as ke,b as Ie,T as a,b6 as w,G as d,z as k,B as r,I as b,h as Y,H as J,as as Te,at as Q,c0 as $e,A as V,l as X,s as p,af as Ue,C as Z,a as Ae,c1 as ze,d as Pe,ba as Be,aj as De,c2 as Ne,N as Le,ab as ee,c3 as Ee,a0 as B,a6 as te,a7 as se,a8 as ne,a1 as ae,a2 as re,a3 as le,i as m,a9 as oe,ag as We,q as Fe,au as Re,aP as Ge,bF as He,c4 as _e}from"./mui-vendor-C1HUv1lu.js";import{h as Ke,r as l,L as ie}from"./react-vendor-BW_9WhSV.js";import{u as qe,c as h,R as x,n as D}from"./admin-features-DSNbd77k.js";const Je=()=>{const{clubName:i}=Ke(),{user:I}=qe(),[N,ce]=l.useState([]),[T,de]=l.useState(null),[he,L]=l.useState(!0),[E,u]=l.useState(null),[W,C]=l.useState(null),[xe,y]=l.useState(!1),[g,$]=l.useState(null),[o,c]=l.useState({title:"",content:"",updateType:"general",isPinned:!1}),[F,R]=l.useState(null),[G,ue]=l.useState({}),[H,_]=l.useState({}),[me,U]=l.useState(!1),[A,v]=l.useState(!1);l.useEffect(()=>{i&&j()},[i]);const j=async()=>{try{L(!0);const t=localStorage.getItem("token"),[s,n]=await Promise.all([h.get(`${x}/club-updates/${encodeURIComponent(i)}`,{headers:{Authorization:`Bearer ${t}`,...D}}),h.get(`${x}/club-info/${encodeURIComponent(i)}`,{headers:{Authorization:`Bearer ${t}`,...D}})]);ce(s.data.updates),de(n.data)}catch(t){u(t.response?.data?.error||"Failed to load club dashboard")}finally{L(!1)}},z=async t=>{try{const s=localStorage.getItem("token"),n=await h.get(`${x}/club-updates/${t}/comments`,{headers:{Authorization:`Bearer ${s}`}});ue(f=>({...f,[t]:n.data.comments}))}catch(s){console.error("Error loading comments:",s)}},je=t=>{F===t?R(null):(R(t),G[t]||z(t))},pe=async()=>{try{const t=localStorage.getItem("token");await h.post(`${x}/club-updates`,{clubName:i,...o},{headers:{Authorization:`Bearer ${t}`,...D}}),C("Update posted successfully!"),y(!1),c({title:"",content:"",updateType:"general",isPinned:!1}),j()}catch(t){u(t.response?.data?.error||"Failed to create update")}},ye=async()=>{if(g)try{const t=localStorage.getItem("token");await h.put(`${x}/club-updates/${g.id}`,o,{headers:{Authorization:`Bearer ${t}`}}),C("Update edited successfully!"),y(!1),$(null),c({title:"",content:"",updateType:"general",isPinned:!1}),j()}catch(t){u(t.response?.data?.error||"Failed to edit update")}},ge=async t=>{if(window.confirm("Are you sure you want to delete this update?"))try{const s=localStorage.getItem("token");await h.delete(`${x}/club-updates/${t}`,{headers:{Authorization:`Bearer ${s}`}}),C("Update deleted successfully!"),j()}catch(s){u(s.response?.data?.error||"Failed to delete update")}},K=async t=>{const s=H[t];if(!(!s||s.trim()===""))try{const n=localStorage.getItem("token");await h.post(`${x}/club-updates/${t}/comments`,{comment:s},{headers:{Authorization:`Bearer ${n}`}}),_(f=>({...f,[t]:""})),z(t),j()}catch(n){u(n.response?.data?.error||"Failed to add comment")}},fe=async(t,s)=>{if(window.confirm("Are you sure you want to delete this comment?"))try{const n=localStorage.getItem("token");await h.delete(`${x}/club-updates/${t}/comments/${s}`,{headers:{Authorization:`Bearer ${n}`}}),z(t),j()}catch(n){u(n.response?.data?.error||"Failed to delete comment")}},q=t=>{t?($(t),c({title:t.title,content:t.content,updateType:t.updateType,isPinned:t.isPinned})):($(null),c({title:"",content:"",updateType:"general",isPinned:!1})),y(!0)},be=t=>{switch(t){case"announcement":return e.jsx(_e,{});case"event":return e.jsx(He,{});case"achievement":return e.jsx(Ge,{});case"urgent":return e.jsx(Re,{});default:return e.jsx(w,{})}},Ce=t=>{switch(t){case"announcement":return"primary";case"event":return"info";case"achievement":return"success";case"urgent":return"error";default:return"default"}},M=()=>`${window.location.origin}/club-dashboard/${encodeURIComponent(i)}`,ve=async()=>{const t=M();try{await navigator.clipboard.writeText(t),v(!0),setTimeout(()=>v(!1),3e3)}catch{const n=document.createElement("textarea");n.value=t,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),v(!0),setTimeout(()=>v(!1),3e3)}};return I?.role!=="Coach"?e.jsx(P,{maxWidth:"lg",sx:{mt:3},children:e.jsx(S,{severity:"info",children:"Club dashboard is only available to coaches."})}):he?e.jsx(P,{maxWidth:"lg",sx:{mt:3,display:"flex",justifyContent:"center"},children:e.jsx(Se,{})}):e.jsxs(P,{maxWidth:"lg",sx:{py:3},children:[e.jsxs(we,{sx:{mb:3},children:[e.jsxs(O,{component:ie,to:"/dashboard",color:"inherit",underline:"hover",sx:{display:"flex",alignItems:"center"},children:[e.jsx(ke,{sx:{mr:.5},fontSize:"inherit"}),"Dashboard"]}),e.jsxs(O,{component:ie,to:"/team-roster",color:"inherit",underline:"hover",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ie,{sx:{mr:.5},fontSize:"inherit"}),"Team Roster"]}),e.jsxs(a,{color:"text.primary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(w,{sx:{mr:.5},fontSize:"inherit"}),i]})]}),E&&e.jsx(S,{severity:"error",sx:{mb:3},onClose:()=>u(null),children:E}),W&&e.jsx(S,{severity:"success",sx:{mb:3},onClose:()=>C(null),children:W}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsxs(d,{item:!0,xs:12,md:4,children:[e.jsxs(k,{sx:{p:3,mb:2},children:[e.jsxs(r,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsxs(a,{variant:"h5",sx:{display:"flex",alignItems:"center"},children:[e.jsx(w,{sx:{mr:1}}),i]}),e.jsx(b,{onClick:()=>U(!0),color:"primary",size:"small",title:"Share Club Link",children:e.jsx(Y,{})})]}),e.jsx(J,{sx:{my:2}}),e.jsxs(r,{sx:{mb:2},children:[e.jsx(a,{variant:"body2",color:"text.secondary",children:"Total Teams"}),e.jsx(a,{variant:"h6",children:T?.totalTeams||0})]}),e.jsxs(r,{sx:{mb:2},children:[e.jsx(a,{variant:"body2",color:"text.secondary",children:"Total Coaches"}),e.jsx(a,{variant:"h6",children:T?.totalCoaches||0})]})]}),e.jsxs(k,{sx:{p:3},children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Coaches & Teams"}),e.jsx(Te,{dense:!0,children:T?.coaches.map((t,s)=>e.jsxs(r,{children:[e.jsxs(Q,{children:[e.jsx($e,{children:e.jsx(V,{children:t.coachName?.split(" ").map(n=>n?.[0]||"").join("")||"?"})}),e.jsx(X,{primary:t.coachName,secondary:`${t.teams.length} team${t.teams.length!==1?"s":""}`})]}),t.teams.map((n,f)=>e.jsx(Q,{sx:{pl:8},children:e.jsx(X,{primary:n.teamName,secondary:`${n.ageGroup} â€¢ ${n.playerCount} players`})},f))]},s))})]})]}),e.jsxs(d,{item:!0,xs:12,md:8,children:[e.jsxs(r,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(a,{variant:"h5",children:"Club Updates"}),e.jsx(p,{startIcon:e.jsx(Ue,{}),variant:"contained",onClick:()=>q(),children:"New Update"})]}),N.length===0?e.jsxs(k,{sx:{p:4,textAlign:"center"},children:[e.jsx(w,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(a,{variant:"h6",color:"text.secondary",children:"No updates yet"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Be the first to post an update for your club!"})]}):e.jsx(r,{children:N.map(t=>e.jsxs(Z,{sx:{mb:2},children:[e.jsxs(Ae,{children:[e.jsxs(r,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsxs(r,{display:"flex",alignItems:"center",gap:1,children:[e.jsxs(V,{children:[t.firstName?.[0]||"",t.lastName?.[0]||""]}),e.jsxs(r,{children:[e.jsxs(a,{variant:"subtitle1",children:[t.firstName," ",t.lastName,t.isPinned&&e.jsx(ze,{fontSize:"small",sx:{ml:1,color:"primary.main"}})]}),e.jsx(a,{variant:"caption",color:"text.secondary",children:new Date(t.createdAt).toLocaleString()})]})]}),e.jsx(Pe,{icon:be(t.updateType),label:t.updateType,size:"small",color:Ce(t.updateType)})]}),e.jsx(a,{variant:"h6",gutterBottom:!0,children:t.title}),e.jsx(a,{variant:"body2",color:"text.secondary",sx:{whiteSpace:"pre-wrap"},children:t.content})]}),e.jsxs(Be,{sx:{justifyContent:"space-between",px:2},children:[e.jsx(r,{children:e.jsx(b,{size:"small",onClick:()=>je(t.id),children:e.jsx(De,{badgeContent:t.commentCount,color:"primary",children:e.jsx(Ne,{})})})}),t.coachId===Number(I?.id)&&e.jsxs(r,{children:[e.jsx(b,{size:"small",onClick:()=>q(t),children:e.jsx(Le,{})}),e.jsx(b,{size:"small",onClick:()=>ge(t.id),children:e.jsx(ee,{})})]})]}),e.jsxs(Ee,{in:F===t.id,children:[e.jsx(J,{}),e.jsxs(r,{sx:{p:2,bgcolor:"grey.50"},children:[e.jsx(a,{variant:"subtitle2",gutterBottom:!0,children:"Comments"}),G[t.id]?.map(s=>e.jsx(Z,{variant:"outlined",sx:{mb:1,p:1},children:e.jsxs(r,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",children:[e.jsxs(r,{children:[e.jsxs(a,{variant:"caption",fontWeight:"bold",children:[s.firstName," ",s.lastName]}),e.jsx(a,{variant:"body2",children:s.comment}),e.jsx(a,{variant:"caption",color:"text.secondary",children:new Date(s.createdAt).toLocaleString()})]}),s.coachId===Number(I?.id)&&e.jsx(b,{size:"small",onClick:()=>fe(t.id,s.id),children:e.jsx(ee,{fontSize:"small"})})]})},s.id)),e.jsxs(r,{display:"flex",gap:1,mt:2,children:[e.jsx(B,{fullWidth:!0,size:"small",placeholder:"Add a comment...",value:H[t.id]||"",onChange:s=>_(n=>({...n,[t.id]:s.target.value})),onKeyPress:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),K(t.id))}}),e.jsx(p,{onClick:()=>K(t.id),variant:"contained",size:"small",children:"Post"})]})]})]})]},t.id))})]})]}),e.jsxs(te,{open:xe,onClose:()=>y(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(se,{children:g?"Edit Update":"Create New Update"}),e.jsx(ne,{children:e.jsxs(d,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(B,{fullWidth:!0,label:"Title",value:o.title,onChange:t=>c({...o,title:t.target.value})})}),e.jsx(d,{item:!0,xs:8,children:e.jsxs(ae,{fullWidth:!0,children:[e.jsx(re,{children:"Update Type"}),e.jsxs(le,{value:o.updateType,label:"Update Type",onChange:t=>c({...o,updateType:t.target.value}),children:[e.jsx(m,{value:"general",children:"General"}),e.jsx(m,{value:"announcement",children:"Announcement"}),e.jsx(m,{value:"event",children:"Event"}),e.jsx(m,{value:"achievement",children:"Achievement"}),e.jsx(m,{value:"urgent",children:"Urgent"})]})]})}),e.jsx(d,{item:!0,xs:4,children:e.jsxs(ae,{fullWidth:!0,children:[e.jsx(re,{children:"Pin"}),e.jsxs(le,{value:o.isPinned?"yes":"no",label:"Pin",onChange:t=>c({...o,isPinned:t.target.value==="yes"}),children:[e.jsx(m,{value:"no",children:"No"}),e.jsx(m,{value:"yes",children:"Yes"})]})]})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(B,{fullWidth:!0,multiline:!0,rows:6,label:"Content",value:o.content,onChange:t=>c({...o,content:t.target.value})})})]})}),e.jsxs(oe,{children:[e.jsx(p,{onClick:()=>y(!1),children:"Cancel"}),e.jsx(p,{onClick:g?ye:pe,variant:"contained",disabled:!o.title||!o.content,children:g?"Save Changes":"Post Update"})]})]}),e.jsxs(te,{open:me,onClose:()=>U(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(se,{children:e.jsxs(r,{display:"flex",alignItems:"center",children:[e.jsx(Y,{sx:{mr:1}}),"Share ",i," Club Link"]})}),e.jsxs(ne,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Share this link with other coaches to invite them to join your club dashboard. They'll need to create a team with the same club name to access it."}),e.jsx(k,{variant:"outlined",sx:{p:2,bgcolor:"grey.50",mb:2},children:e.jsx(a,{variant:"body2",sx:{wordBreak:"break-all",fontFamily:"monospace",fontSize:"0.9rem"},children:M()})}),e.jsx(p,{fullWidth:!0,variant:"contained",startIcon:A?e.jsx(We,{}):e.jsx(Fe,{}),onClick:ve,color:A?"success":"primary",children:A?"Link Copied!":"Copy Link to Clipboard"}),e.jsx(S,{severity:"info",sx:{mt:2},children:e.jsxs(a,{variant:"body2",children:[e.jsx("strong",{children:"Note:"}),' Coaches must have at least one team with the club name "',i,'" to view and post in this club dashboard.']})})]}),e.jsx(oe,{children:e.jsx(p,{onClick:()=>U(!1),children:"Close"})})]})]})};export{Je as default};
