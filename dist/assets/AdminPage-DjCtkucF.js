import{av as We,aw as De,j as e,b9 as z,B as n,T as t,s as l,A as Pe,aE as ze,bX as B,I as M,bQ as Me,M as Fe,i as D,al as H,H as Ue,v as F,aZ as R,aK as Y,n as $,G as d,C as m,a as j,b6 as le,y as O,bY as q,aB as Ee,z as Ne,ah as Ge,ai as Q,aA as Be,af as ce,am as He,an as Re,ao as Ye,ap as V,aq as r,ar as $e,ag as Oe,bj as qe,N as Qe,bi as Ve,aO as _e,ab as Ke,ba as _,ak as Xe,b3 as Ze,a6 as de,a7 as xe,a8 as he,a0 as h,a9 as ue}from"./mui-vendor-C1HUv1lu.js";import{u as Je,r as i}from"./react-vendor-BW_9WhSV.js";import{u as es,S as ss,l as y,m as ts,o as ge}from"./admin-features-DSNbd77k.js";const is=()=>{console.log("ðŸ” AdminPage render start"),console.log("ðŸ”— Hook 1: useAuth");const{impersonateUser:me,stopImpersonation:je,isImpersonating:p,user:c}=es();console.log("ðŸ”— Hook 2: useNavigate");const S=Je();console.log("ðŸ”— Hook 3: useTheme");const pe=We();console.log("ðŸ”— Hook 4: useMediaQuery");const P=De(pe.breakpoints.down("md")),[K,X]=i.useState({totalUsers:0,totalMatches:0}),[Z,J]=i.useState(!1),[U,L]=i.useState([]),[ye,ee]=i.useState(!1),[se,u]=i.useState(null),[te,f]=i.useState(null),[be,v]=i.useState(!1),[b,E]=i.useState(null),[T,fe]=i.useState(0),[ne,ae]=i.useState(null),[o,x]=i.useState({name:"",region:"",ageGroup:"",country:"",url:"",description:""}),[g,W]=i.useState({email:"",firstName:"",lastName:"",password:""}),[ve,C]=i.useState(!1),[re,A]=i.useState(!1);if(console.log("ðŸ” All hooks declared, user check:",c?"exists":"null"),i.useEffect(()=>{(async()=>{if(!(!c||c.role!=="Admin"))try{ee(!0);const a=await y.getAll();L(a.leagues||[])}catch(a){u(ts(a))}finally{ee(!1)}})()},[c]),i.useEffect(()=>{(async()=>{if(!(!c||c.role!=="Admin")){J(!0);try{const a=await fetch("/api/analytics/overview",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!a.ok)throw new Error("Failed to fetch analytics");const k=await a.json();X({totalUsers:k.overview?.totalUsers??0,totalMatches:k.overview?.totalMatches??0})}catch{X({totalUsers:0,totalMatches:0})}finally{J(!1)}}})()},[c]),!c)return e.jsx(z,{maxWidth:"lg",children:e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsxs("div",{children:[e.jsx(t,{variant:"h4",color:"error",gutterBottom:!0,children:"Access Denied"}),e.jsx(t,{variant:"body1",children:"Please log in to access the admin panel."}),e.jsx(l,{variant:"contained",onClick:()=>S("/login"),sx:{mt:2},children:"Go to Login"})]})})});if(c.role!=="Admin")return e.jsx(z,{maxWidth:"lg",children:e.jsxs(n,{sx:{textAlign:"center",mt:4},children:[e.jsx(t,{variant:"h4",color:"error",gutterBottom:!0,children:"Access Denied"}),e.jsx(t,{variant:"body1",children:"You do not have permission to access this page."}),e.jsx(l,{variant:"contained",onClick:()=>S("/dashboard"),sx:{mt:2},children:"Go to Dashboard"})]})});const ie=()=>{u(null),f(null)},Ce=(s,a)=>{fe(a)},Ae=s=>{ae(s.currentTarget)},w=()=>{ae(null)},we=async()=>{try{await y.create(o),f("League created successfully"),v(!1),x({name:"",region:"",ageGroup:"",country:"",url:"",description:""});const s=await y.getAll();L(s.leagues||[])}catch(s){u(s.response?.data?.error||"Failed to create league")}},Ie=async()=>{if(b)try{await y.update(typeof b.id=="string"?parseInt(b.id):b.id,o),f("League updated successfully"),v(!1),E(null),x({name:"",region:"",ageGroup:"",country:"",url:"",description:""});const s=await y.getAll();L(s.leagues||[])}catch(s){u(s.response?.data?.error||"Failed to update league")}},ke=async s=>{if(window.confirm("Are you sure you want to delete this league? This action cannot be undone."))try{await y.delete(s),f("League deleted successfully");const a=await y.getAll();L(a.leagues||[])}catch(a){u(a.response?.data?.error||"Failed to delete league")}},Se=async(s,a)=>{const k=a?"freeze":"unfreeze";if(window.confirm(`Are you sure you want to ${k} this league? ${a?"Users will not be able to select it.":"Users will be able to select it again."}`))try{await ge.freezeLeague(s,!a),f(`League ${k}d successfully`);const G=await y.getAll();L(G.leagues||[])}catch(G){u(G.response?.data?.error||`Failed to ${k} league`)}},Le=s=>{E(s),x({name:s.name,region:s.region||"",ageGroup:s.ageGroup||"",country:s.country||"",url:s.url||"",description:s.description||""}),v(!0)},oe=()=>{E(null),x({name:"",region:"",ageGroup:"",country:"",url:"",description:""}),v(!0)},Te=async()=>{try{await ge.createAdmin(g),f("Admin user created successfully"),C(!1),W({email:"",firstName:"",lastName:"",password:""})}catch(s){u(s.response?.data?.error||"Failed to create admin user")}},I=s=>{if(re){console.log("â³ Impersonation already in progress, ignoring request");return}try{A(!0),console.log("ðŸ”„ Attempting to impersonate user type:",s),console.log("ðŸ‘¤ Current user:",c),console.log("ðŸ” Is impersonating:",p),me(s),console.log("âœ… Impersonation successful, navigating to dashboard..."),setTimeout(()=>{S("/dashboard"),A(!1)},100)}catch(a){console.error("âŒ Error during user impersonation:",a),u("Failed to switch user. Please try again."),A(!1)}},N=()=>{if(re){console.log("â³ Impersonation operation already in progress, ignoring request");return}try{A(!0),console.log("ðŸ”„ Stopping impersonation..."),je(),console.log("âœ… Impersonation stopped, navigating to admin..."),setTimeout(()=>{S("/admin"),A(!1)},100)}catch(s){console.error("âŒ Error stopping impersonation:",s),u("Failed to stop impersonation. Please try again."),A(!1)}};return e.jsxs(n,{sx:{flexGrow:1,minHeight:"100vh",backgroundColor:"background.default"},children:[e.jsx(n,{sx:{background:"linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%)",borderRadius:0,mb:3},children:e.jsx(z,{maxWidth:"lg",children:e.jsxs(n,{sx:{py:3,px:2},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",flexGrow:1},children:[e.jsx(Pe,{sx:{mr:2,bgcolor:"rgba(255,255,255,0.2)",width:56,height:56},children:e.jsx(ze,{sx:{fontSize:32}})}),e.jsxs(n,{children:[e.jsx(t,{variant:P?"h5":"h4",component:"h1",sx:{fontWeight:700,color:"white",textShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:"Admin Dashboard"}),e.jsx(t,{variant:"body1",sx:{color:"rgba(255,255,255,0.9)",fontWeight:500},children:p?`Currently viewing as ${c.role}`:"System Management & Analytics"})]})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[!P&&e.jsx(e.Fragment,{children:p&&e.jsx(l,{startIcon:e.jsx(B,{}),variant:"outlined",sx:{borderColor:"rgba(255,255,255,0.5)",color:"white","&:hover":{borderColor:"white",bgcolor:"rgba(255,255,255,0.1)"}},onClick:N,children:"Stop Impersonation"})}),e.jsx(M,{color:"inherit",onClick:Ae,sx:{bgcolor:"rgba(255,255,255,0.1)","&:hover":{bgcolor:"rgba(255,255,255,0.2)"}},children:e.jsx(Me,{})})]})]})})}),e.jsxs(Fe,{anchorEl:ne,open:!!ne,onClose:w,PaperProps:{sx:{minWidth:200}},children:[e.jsxs(D,{onClick:()=>{w(),C(!0)},children:[e.jsx(H,{sx:{mr:2}}),"Create Admin"]}),e.jsx(Ue,{}),p?e.jsxs(D,{onClick:()=>{w(),N()},children:[e.jsx(B,{sx:{mr:2}}),"Stop Impersonation"]}):e.jsxs(e.Fragment,{children:[e.jsxs(D,{onClick:()=>{w(),I("Player")},children:[e.jsx(F,{sx:{mr:2}}),"Test as Player"]}),e.jsxs(D,{onClick:()=>{w(),I("Coach")},children:[e.jsx(R,{sx:{mr:2}}),"Test as Coach"]}),e.jsxs(D,{onClick:()=>{w(),I("Parent/Guardian")},children:[e.jsx(Y,{sx:{mr:2}}),"Test as Parent"]})]})]}),e.jsxs(z,{maxWidth:"lg",sx:{py:4},children:[se&&e.jsx($,{severity:"error",sx:{mb:3},onClose:ie,children:se}),te&&e.jsx($,{severity:"success",sx:{mb:3},onClose:ie,children:te}),p&&e.jsxs($,{severity:"info",sx:{mb:3},action:e.jsx(l,{color:"inherit",size:"small",onClick:N,startIcon:e.jsx(B,{}),children:"Stop"}),children:[e.jsx(t,{variant:"body2",fontWeight:"bold",children:"Impersonation Mode Active"}),"You are currently viewing the platform as a ",e.jsx("strong",{children:c.role}),'. Click "Stop" to return to admin view.']}),e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(m,{sx:{background:"linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%)",color:"white"},children:e.jsx(j,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(n,{children:[e.jsx(t,{variant:"h4",fontWeight:"bold",children:U.length}),e.jsx(t,{variant:"body2",sx:{opacity:.9},children:"Active Leagues"})]}),e.jsx(le,{sx:{fontSize:40,opacity:.8}})]})})})}),e.jsx(d,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(m,{sx:{background:"linear-gradient(135deg, #64748B 0%, #475569 100%)",color:"white"},children:e.jsx(j,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(n,{children:[e.jsx(t,{variant:"h4",fontWeight:"bold",children:Z?e.jsx(O,{size:28,color:"inherit"}):K.totalUsers}),e.jsx(t,{variant:"body2",sx:{opacity:.9},children:"Total Users"})]}),e.jsx(q,{sx:{fontSize:40,opacity:.8}})]})})})}),e.jsx(d,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(m,{sx:{background:"linear-gradient(135deg, #94A3B8 0%, #64748B 100%)",color:"white"},children:e.jsx(j,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(n,{children:[e.jsx(t,{variant:"h4",fontWeight:"bold",children:Z?e.jsx(O,{size:28,color:"inherit"}):K.totalMatches}),e.jsx(t,{variant:"body2",sx:{opacity:.9},children:"Active Matches"})]}),e.jsx(Ee,{sx:{fontSize:40,opacity:.8}})]})})})})]}),e.jsxs(Ne,{elevation:2,sx:{mb:4},children:[e.jsxs(Ge,{value:T,onChange:Ce,variant:P?"scrollable":"fullWidth",scrollButtons:"auto",sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(Q,{label:"League Management",icon:e.jsx(le,{}),iconPosition:"start",sx:{minHeight:64}}),e.jsx(Q,{label:"User Testing",icon:e.jsx(F,{}),iconPosition:"start",sx:{minHeight:64}}),e.jsx(Q,{label:"System Settings",icon:e.jsx(Be,{}),iconPosition:"start",sx:{minHeight:64}})]}),e.jsxs(n,{sx:{p:3},children:[T===0&&e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(t,{variant:"h5",component:"h2",children:"League Management"}),e.jsx(l,{variant:"contained",startIcon:e.jsx(ce,{}),onClick:oe,children:"Add League"})]}),ye?e.jsx(n,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(O,{})}):e.jsx(He,{children:e.jsxs(Re,{children:[e.jsx(Ye,{children:e.jsxs(V,{children:[e.jsx(r,{children:"Name"}),e.jsx(r,{children:"Country"}),e.jsx(r,{children:"Region"}),e.jsx(r,{children:"Age Group"}),e.jsx(r,{children:"URL"}),e.jsx(r,{children:"Description"}),e.jsx(r,{align:"center",children:"Status"}),e.jsx(r,{align:"center",children:"Actions"})]})}),e.jsxs($e,{children:[U.map(s=>e.jsxs(V,{hover:!0,children:[e.jsx(r,{children:e.jsx(t,{variant:"subtitle2",fontWeight:"bold",children:s.name})}),e.jsx(r,{children:e.jsx(t,{variant:"body2",color:"text.secondary",children:s.country||"England"})}),e.jsx(r,{children:e.jsx(t,{variant:"body2",color:"text.secondary",children:s.region||"N/A"})}),e.jsx(r,{children:e.jsx(t,{variant:"body2",color:"text.secondary",children:s.ageGroup||"N/A"})}),e.jsx(r,{children:s.url?e.jsx(t,{variant:"body2",color:"primary",component:"a",href:s.url,target:"_blank",rel:"noopener noreferrer",sx:{textDecoration:"none","&:hover":{textDecoration:"underline"}},children:"View League"}):e.jsx(t,{variant:"body2",color:"text.secondary",children:"No URL"})}),e.jsx(r,{children:e.jsx(t,{variant:"body2",color:"text.secondary",children:s.description||"No description"})}),e.jsx(r,{align:"center",children:s.isActive?e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:.5},children:[e.jsx(Oe,{fontSize:"small",sx:{color:"success.main"}}),e.jsx(t,{variant:"body2",color:"success.main",children:"Active"})]}):e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:.5},children:[e.jsx(qe,{fontSize:"small",sx:{color:"warning.main"}}),e.jsx(t,{variant:"body2",color:"warning.main",children:"Frozen"})]})}),e.jsxs(r,{align:"center",children:[e.jsx(M,{color:"primary",onClick:()=>Le(s),size:"small",title:"Edit league",children:e.jsx(Qe,{})}),e.jsx(M,{color:s.isActive?"warning":"success",onClick:()=>Se(typeof s.id=="string"?parseInt(s.id):s.id,s.isActive??!1),size:"small",title:s.isActive?"Freeze league":"Unfreeze league",children:s.isActive?e.jsx(Ve,{}):e.jsx(_e,{})}),e.jsx(M,{color:"error",onClick:()=>ke(typeof s.id=="string"?parseInt(s.id):s.id),size:"small",title:"Delete league",children:e.jsx(Ke,{})})]})]},s.id)),U.length===0&&e.jsx(V,{children:e.jsx(r,{colSpan:3,align:"center",sx:{py:4},children:e.jsx(t,{variant:"body2",color:"text.secondary",children:"No leagues found. Create your first league to get started."})})})]})]})})]}),T===1&&e.jsxs(n,{children:[e.jsx(t,{variant:"h5",component:"h2",sx:{mb:2},children:"User Testing (Impersonation)"}),e.jsx(t,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Test the platform from different user perspectives without creating separate accounts."}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(m,{sx:{height:"100%",transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-4px)",boxShadow:4}},children:[e.jsxs(j,{sx:{textAlign:"center",pb:1},children:[e.jsx(F,{sx:{fontSize:48,color:"info.main",mb:2}}),e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Player"}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Test player features like availability posting and team searching"})]}),e.jsx(_,{sx:{px:2,pb:2},children:e.jsx(l,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(F,{}),onClick:()=>I("Player"),disabled:p,children:"Test as Player"})})]})}),e.jsx(d,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(m,{sx:{height:"100%",transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-4px)",boxShadow:4}},children:[e.jsxs(j,{sx:{textAlign:"center",pb:1},children:[e.jsx(R,{sx:{fontSize:48,color:"warning.main",mb:2}}),e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Coach"}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Test coach features like team management and player recruitment"})]}),e.jsx(_,{sx:{px:2,pb:2},children:e.jsx(l,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(R,{}),onClick:()=>I("Coach"),disabled:p,children:"Test as Coach"})})]})}),e.jsx(d,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(m,{sx:{height:"100%",transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-4px)",boxShadow:4}},children:[e.jsxs(j,{sx:{textAlign:"center",pb:1},children:[e.jsx(Y,{sx:{fontSize:48,color:"success.main",mb:2}}),e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Parent"}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Test parent features for managing children's football activities"})]}),e.jsx(_,{sx:{px:2,pb:2},children:e.jsx(l,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(Y,{}),onClick:()=>I("Parent/Guardian"),disabled:p,children:"Test as Parent"})})]})})]})]}),T===2&&e.jsxs(n,{children:[e.jsx(t,{variant:"h5",component:"h2",sx:{mb:3},children:"System Settings"}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(m,{children:e.jsxs(j,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(H,{sx:{mr:2,color:"primary.main"}}),e.jsx(t,{variant:"h6",children:"Create Admin User"})]}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Create a new administrator account with full system access."}),e.jsx(l,{variant:"outlined",startIcon:e.jsx(H,{}),onClick:()=>C(!0),fullWidth:!0,children:"Create Admin Account"})]})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(m,{children:e.jsxs(j,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(q,{sx:{mr:2,color:"info.main"}}),e.jsx(t,{variant:"h6",children:"User Management"})]}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Manage users, grant beta access, view user details, and moderate accounts."}),e.jsx(l,{variant:"outlined",startIcon:e.jsx(q,{}),onClick:()=>S("/admin/users"),fullWidth:!0,children:"Manage Users"})]})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(m,{children:e.jsxs(j,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Xe,{sx:{mr:2,color:"success.main"}}),e.jsx(t,{variant:"h6",children:"Site Activity & Traffic"})]}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"View platform activity, user growth, and recent site traffic."}),e.jsx(ss,{})]})})})]})]})]})]}),P&&e.jsx(Ze,{color:"primary","aria-label":"add",sx:{position:"fixed",bottom:16,right:16,zIndex:1e3},onClick:T===0?oe:()=>C(!0),children:e.jsx(ce,{})})]}),e.jsxs(de,{open:be,onClose:()=>v(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(xe,{children:b?"Edit League":"Create New League"}),e.jsxs(he,{children:[e.jsx(h,{autoFocus:!0,margin:"dense",label:"League Name",type:"text",fullWidth:!0,variant:"outlined",value:o.name,onChange:s=>x({...o,name:s.target.value}),sx:{mb:2}}),e.jsx(h,{margin:"dense",label:"Region",type:"text",fullWidth:!0,variant:"outlined",value:o.region,onChange:s=>x({...o,region:s.target.value}),sx:{mb:2}}),e.jsx(h,{margin:"dense",label:"Age Group",type:"text",fullWidth:!0,variant:"outlined",value:o.ageGroup,onChange:s=>x({...o,ageGroup:s.target.value}),sx:{mb:2}}),e.jsx(h,{margin:"dense",label:"Country",type:"text",fullWidth:!0,variant:"outlined",value:o.country,onChange:s=>x({...o,country:s.target.value}),placeholder:"England",sx:{mb:2}}),e.jsx(h,{margin:"dense",label:"League URL",type:"url",fullWidth:!0,variant:"outlined",value:o.url,onChange:s=>x({...o,url:s.target.value}),sx:{mb:2}}),e.jsx(h,{margin:"dense",label:"Description",type:"text",fullWidth:!0,variant:"outlined",multiline:!0,rows:3,value:o.description,onChange:s=>x({...o,description:s.target.value})})]}),e.jsxs(ue,{children:[e.jsx(l,{onClick:()=>v(!1),children:"Cancel"}),e.jsx(l,{onClick:b?Ie:we,variant:"contained",children:b?"Update":"Create"})]})]}),e.jsxs(de,{open:ve,onClose:()=>C(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(xe,{children:"Create Admin User"}),e.jsxs(he,{children:[e.jsx(h,{autoFocus:!0,margin:"dense",label:"Email",type:"email",fullWidth:!0,variant:"outlined",value:g.email,onChange:s=>W({...g,email:s.target.value}),sx:{mb:2}}),e.jsx(h,{margin:"dense",label:"First Name",type:"text",fullWidth:!0,variant:"outlined",value:g.firstName,onChange:s=>W({...g,firstName:s.target.value}),sx:{mb:2}}),e.jsx(h,{margin:"dense",label:"Last Name",type:"text",fullWidth:!0,variant:"outlined",value:g.lastName,onChange:s=>W({...g,lastName:s.target.value}),sx:{mb:2}}),e.jsx(h,{margin:"dense",label:"Password",type:"password",fullWidth:!0,variant:"outlined",value:g.password,onChange:s=>W({...g,password:s.target.value})})]}),e.jsxs(ue,{children:[e.jsx(l,{onClick:()=>C(!1),children:"Cancel"}),e.jsx(l,{onClick:Te,variant:"contained",children:"Create Admin"})]})]})]})};export{is as default};
